<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>CollegeQuest - Your AI College Planning Assistant</title>
    <style>
        /* =========================
           YOUR ORIGINAL STYLES
           (unchanged)
        ==========================*/
        * {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }
        :root {
            --primary: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
            --secondary: linear-gradient(135deg, #F093FB 0%, #F5576C 100%);
            --success: linear-gradient(135deg, #00C896 0%, #00B4D8 100%);
            --warning: linear-gradient(135deg, #FFB700 0%, #FF6B6B 100%);
            --info: linear-gradient(135deg, #4FACFE 0%, #00F2FE 100%);
            --dark: #0F0F1E; --light: #FFFFFF;
            --glass: rgba(255, 255, 255, 0.1); --glass-dark: rgba(0,0,0,0.3);
            --blur: 20px;
            --text-primary:#FFFFFF; --text-secondary:rgba(255,255,255,0.7);
            --border: rgba(255,255,255,0.1);
            --glow-purple:#764BA2; --glow-blue:#667EEA;
            --ease-bounce:cubic-bezier(0.68,-0.55,0.265,1.55);
            --ease-smooth:cubic-bezier(0.4,0,0.2,1);
        }
        [data-theme="light"] {
            --dark:#FFFFFF; --light:#0F0F1E; --glass:rgba(0,0,0,0.05); --glass-dark:rgba(255,255,255,0.8);
            --text-primary:#0F0F1E; --text-secondary:rgba(0,0,0,0.6); --border:rgba(0,0,0,0.1);
        }
        body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
            background: var(--dark); color: var(--text-primary); overflow-x:hidden; min-height:100vh; }
        .animated-bg { position:fixed; inset:0; z-index:-1;
            background:
            radial-gradient(circle at 20% 50%, rgba(102,126,234,0.3) 0%, transparent 50%),
            radial-gradient(circle at 80% 80%, rgba(118,75,162,0.3) 0%, transparent 50%),
            radial-gradient(circle at 40% 20%, rgba(240,147,251,0.3) 0%, transparent 50%);
            animation: backgroundShift 20s ease infinite; }
        @keyframes backgroundShift { 0%,100%{transform:rotate(0) scale(1)} 50%{transform:rotate(180deg) scale(1.1)} }
        .container { max-width:1400px; margin:0 auto; padding:20px; position:relative; z-index:1; }
        header { display:flex; justify-content:space-between; align-items:center; padding:20px 0; margin-bottom:30px; }
        .logo { font-size:28px; font-weight:800; background:var(--primary); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; display:flex; align-items:center; gap:10px; }
        .logo svg { width:32px; height:32px; fill:url(#gradient); }
        .nav-tabs { display:flex; gap:10px; padding:5px; background:var(--glass); border-radius:50px; backdrop-filter:blur(10px); margin-bottom:30px; overflow-x:auto; scrollbar-width:none;}
        .nav-tabs::-webkit-scrollbar{display:none;}
        .nav-tab{ padding:12px 24px; border:none; background:transparent; color:var(--text-secondary); font-weight:600; border-radius:50px; cursor:pointer; transition:all .3s var(--ease-smooth); white-space:nowrap; font-size:14px;}
        .nav-tab.active{ background:var(--primary); color:#fff; box-shadow:0 4px 15px rgba(102,126,234,0.3);}
        .nav-tab:hover:not(.active){ background:var(--glass);}
        .card{ background:var(--glass); backdrop-filter:blur(var(--blur)); -webkit-backdrop-filter:blur(var(--blur));
            border-radius:20px; border:1px solid var(--border); padding:24px; transition:all .3s var(--ease-smooth); position:relative; overflow:hidden;}
        .card:hover{ transform:translateY(-5px); box-shadow:0 20px 40px rgba(102,126,234,0.2); border-color:rgba(102,126,234,0.5);}
        .btn{ padding:12px 24px; border:none; border-radius:50px; font-weight:600; font-size:14px; cursor:pointer;
            transition:all .3s var(--ease-bounce); position:relative; overflow:hidden; display:inline-flex; align-items:center; gap:8px;}
        .btn-primary{ background:var(--primary); color:#fff; box-shadow:0 4px 15px rgba(102,126,234,0.3);}
        .btn-primary:hover{ transform:translateY(-2px) scale(1.05); box-shadow:0 6px 25px rgba(102,126,234,0.5);}
        .btn-success{ background:var(--success); color:#fff;}
        .btn-glass{ background:var(--glass); backdrop-filter:blur(10px); color:var(--text-primary); border:1px solid var(--border);}
        .form-group{ margin-bottom:24px; } .form-label{ display:block; margin-bottom:8px; font-weight:600; font-size:12px; text-transform:uppercase; letter-spacing:1px; color:var(--text-secondary);}
        .form-input{ width:100%; padding:14px 20px; background:var(--glass); border:2px solid var(--border); border-radius:15px; color:var(--text-primary); font-size:16px; transition:all .3s var(--ease-smooth);}
        .form-input:focus{ outline:none; border-color:var(--glow-purple); box-shadow:0 0 20px rgba(118,75,162,0.2);}
        .comparison-container{ display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:30px;}
        .comparison-card{ background:var(--glass); border-radius:20px; padding:20px; position:relative; border:2px solid var(--border); transition:all .3s var(--ease-smooth);}
        .comparison-card.recommended{ border-color:var(--glow-blue); box-shadow:0 0 30px rgba(102,126,234,0.3);}
        .comparison-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;}
        .comparison-title{ font-size:20px; font-weight:700;}
        .comparison-badge{ padding:6px 12px; border-radius:20px; font-size:11px; font-weight:700; text-transform:uppercase; background:var(--success); color:#fff;}
        .comparison-metric{ display:flex; justify-content:space-between; align-items:center; padding:12px 0; border-bottom:1px solid var(--border);}
        .comparison-metric:last-child{ border-bottom:none;}
        .metric-label{ color:var(--text-secondary); font-size:14px;} .metric-value{ font-weight:600; font-size:16px;}
        .metric-value.positive{ color:#00C896;} .metric-value.negative{ color:#FF6B6B;}
        .ai-chat-container{ height:500px; display:flex; flex-direction:column; background:var(--glass); border-radius:20px; overflow:hidden; border:1px solid var(--border);}
        .chat-header{ background:var(--primary); color:#fff; padding:20px; display:flex; align-items:center; gap:15px;}
        .chat-avatar{ width:40px; height:40px; border-radius:50%; background:rgba(255,255,255,0.2); display:flex; align-items:center; justify-content:center;}
        .chat-messages{ flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:15px;}
        .message{ max-width:70%; padding:15px 20px; border-radius:20px; animation:messageSlide .3s var(--ease-smooth);}
        @keyframes messageSlide{ from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)}}
        .message.user{ align-self:flex-end; background:var(--primary); color:#fff;}
        .message.ai{ align-self:flex-start; background:var(--glass); border:1px solid var(--border);}
        .message.typing{ display:flex; gap:5px; padding:20px;}
        .typing-dot{ width:8px; height:8px; background:var(--text-secondary); border-radius:50%; animation:typingBounce 1.4s infinite ease-in-out;}
        .typing-dot:nth-child(1){ animation-delay:-.32s;} .typing-dot:nth-child(2){ animation-delay:-.16s;}
        @keyframes typingBounce{ 0%,80%,100%{ transform:scale(0.8); opacity:.5 } 40%{ transform:scale(1); opacity:1 } }
        .chat-input-container{ padding:20px; border-top:1px solid var(--border); display:flex; gap:10px;}
        .chat-input{ flex:1; padding:12px 20px; background:var(--glass); border:1px solid var(--border); border-radius:50px; color:var(--text-primary); font-size:14px;}
        .chat-send{ width:48px; height:48px; border-radius:50%; background:var(--primary); border:none; color:#fff; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all .3s var(--ease-smooth);}
        .chat-send:hover{ transform:scale(1.1);}
        .schools-grid{ display:grid; grid-template-columns:repeat(auto-fill, minmax(300px, 1fr)); gap:20px; margin-bottom:30px;}
        .school-card{ background:var(--glass); border-radius:20px; overflow:hidden; transition:all .3s var(--ease-smooth); cursor:pointer; position:relative;}
        .school-card:hover{ transform:translateY(-5px); box-shadow:0 20px 40px rgba(0,0,0,0.2);}
        .school-image{ width:100%; height:200px; object-fit:cover;}
        .school-content{ padding:20px;} .school-name{ font-size:20px; font-weight:700; margin-bottom:8px;}
        .school-location{ color:var(--text-secondary); font-size:14px; margin-bottom:15px;}
        .school-stats{ display:flex; justify-content:space-between; font-size:14px;}
        .school-stat{ text-align:center;} .stat-value{ font-weight:700; display:block; margin-bottom:4px;}
        .stat-label{ color:var(--text-secondary); font-size:11px; text-transform:uppercase;}
        .progress-grid{ display:grid; grid-template-columns:repeat(auto-fit, minmax(250px,1fr)); gap:20px; margin-bottom:30px;}
        .progress-card{ background:var(--glass); border-radius:20px; padding:20px; text-align:center; border:1px solid var(--border);}
        .progress-ring{ width:120px; height:120px; margin:0 auto 20px; position:relative;}
        .progress-ring svg{ transform:rotate(-90deg);} .progress-ring-bg{ fill:none; stroke:var(--border); stroke-width:8;}
        .progress-ring-fill{ fill:none; stroke:url(#gradient); stroke-width:8; stroke-linecap:round; transition:stroke-dashoffset 1s var(--ease-smooth);}
        .progress-value{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:24px; font-weight:700;}
        .progress-label{ font-size:14px; color:var(--text-secondary);}
        .stats-grid{ display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:20px; margin-bottom:30px;}
        .stat-card{ background:var(--glass); border-radius:20px; padding:20px; text-align:center; border:1px solid var(--border); position:relative; overflow:hidden;}
        .stat-icon{ font-size:32px; margin-bottom:10px;} .stat-number{ font-size:32px; font-weight:800; background:var(--primary); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;}
        .stat-description{ font-size:12px; color:var(--text-secondary); text-transform:uppercase; letter-spacing:1px; margin-top:8px;}
        .social-feed{ max-height:500px; overflow-y:auto; padding:20px; background:var(--glass); border-radius:20px; border:1px solid var(--border);}
        .social-post{ padding:15px; border-bottom:1px solid var(--border); display:flex; gap:15px;}
        .social-post:last-child{ border-bottom:none;}
        .social-avatar{ width:40px; height:40px; border-radius:50%; background:var(--primary); display:flex; align-items:center; justify-content:center; color:white; font-weight:600;}
        .social-content{ flex:1;} .social-name{ font-weight:600; margin-bottom:5px;} .social-text{ color:var(--text-secondary); font-size:14px; margin-bottom:10px;}
        .social-actions{ display:flex; gap:15px; font-size:12px; color:var(--text-secondary);} .social-action{ cursor:pointer; transition:color .3s;} .social-action:hover{ color:var(--text-primary);}
        .toast{ position:fixed; bottom:100px; left:50%; transform:translateX(-50%) translateY(100px); background:var(--glass-dark); backdrop-filter:blur(20px); color:white; padding:15px 25px; border-radius:50px; box-shadow:0 10px 30px rgba(0,0,0,0.3); z-index:3000; opacity:0; transition:all .3s var(--ease-bounce); border:1px solid rgba(255,255,255,0.1);}
        .toast.show{ transform:translateX(-50%) translateY(0); opacity:1;}
        .skeleton{ background:linear-gradient(90deg, var(--glass) 0%, var(--border) 50%, var(--glass) 100%); background-size:200% 100%; animation:skeleton 1.5s ease-in-out infinite; border-radius:10px;}
        @keyframes skeleton{ 0%{ background-position:200% 0 } 100%{ background-position:-200% 0 } }
        @media (max-width:768px){
            .container{ padding:15px; } .comparison-container{ grid-template-columns:1fr; } .schools-grid{ grid-template-columns:1fr; }
            .nav-tabs{ gap:5px; } .nav-tab{ padding:10px 16px; font-size:12px; } .message{ max-width:85%; }
        }

        /* =========================
           SMALL ADDITIONS FOR PLANNING
        ==========================*/
        .planning-stats { display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:20px; margin-bottom:20px; }
        .task-list { list-style:none; padding:0; }
        .task-list li { padding:10px 14px; margin-bottom:8px; background:var(--glass); border:1px solid var(--border); border-radius:12px; display:flex; justify-content:space-between; align-items:center; }
        .task-list li.completed { text-decoration:line-through; opacity:.7; }
        .task-action { border:none; padding:6px 10px; border-radius:8px; background:var(--success); color:white; cursor:pointer; font-size:12px; }
        .task-action.secondary { background:var(--glass); border:1px solid var(--border); color:var(--text-primary); }
    </style>
</head>
<body>
    <div class="animated-bg"></div>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#667EEA;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#764BA2;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path d="M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3z" fill="url(#gradient)"/>
                </svg>
                CollegeQuest
            </div>
            <div>
                <button class="btn btn-glass" onclick="toggleTheme()">üåô</button>
                <button class="btn btn-primary" onclick="showOnboarding()">Get Started</button>
            </div>
        </header>

        <!-- Navigation -->
        <div class="nav-tabs" id="navTabs">
            <button class="nav-tab active" onclick="showTab('planning', this)">Planning</button>
            <button class="nav-tab" onclick="showTab('dashboard', this)">Dashboard</button>
            <button class="nav-tab" onclick="showTab('compare', this)">In vs Out of State</button>
            <button class="nav-tab" onclick="showTab('ai-assistant', this)">AI Assistant</button>
            <button class="nav-tab" onclick="showTab('schools', this)">Schools</button>
            <button class="nav-tab" onclick="showTab('applications', this)">Applications</button>
            <button class="nav-tab" onclick="showTab('scholarships', this)">Scholarships</button>
            <button class="nav-tab" onclick="showTab('community', this)">Community</button>
        </div>

        <!-- Main Content -->
        <main id="mainContent">
            <!-- Planning (NEW, default) -->
            <div id="planning-tab" class="tab-content">
                <h2 style="margin-bottom: 20px;">üìÖ Your College Quest Plan</h2>

                <div class="planning-stats">
                    <div class="progress-card">
                        <div class="progress-value" id="streakCount">üî• 0 days</div>
                        <div class="progress-label">Daily Streak</div>
                    </div>
                    <div class="progress-card">
                        <div class="progress-value" id="milestonesCount">0/0</div>
                        <div class="progress-label">Milestones Completed</div>
                    </div>
                </div>

                <div class="card" style="margin-bottom:20px;">
                    <h3>üéØ Upcoming Tasks</h3>
                    <ul id="taskList" class="task-list"></ul>
                    <button class="btn btn-glass task-reset" onclick="resetPlanning()">üîÑ Reset Plan</button>
                </div>

                <div class="card">
                    <h3>üìÜ Roadmap</h3>
                    <p style="color:var(--text-secondary); font-size:14px;">Your tasks plotted against deadlines.</p>
                    <div id="calendarView" style="height:250px; background:var(--glass); border-radius:15px; margin-top:10px;"></div>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboard-tab" class="tab-content" style="display:none;">
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-icon">üéØ</div><div class="stat-number">12</div><div class="stat-description">Matched Schools</div></div>
                    <div class="stat-card"><div class="stat-icon">üí∞</div><div class="stat-number">$45K</div><div class="stat-description">Potential Savings</div></div>
                    <div class="stat-card"><div class="stat-icon">üìù</div><div class="stat-number">3/8</div><div class="stat-description">Apps Submitted</div></div>
                    <div class="stat-card"><div class="stat-icon">‚è∞</div><div class="stat-number">15</div><div class="stat-description">Days to Deadline</div></div>
                </div>

                <div class="progress-grid">
                    <div class="progress-card">
                        <div class="progress-ring">
                            <svg width="120" height="120">
                                <circle cx="60" cy="60" r="50" class="progress-ring-bg"></circle>
                                <circle cx="60" cy="60" r="50" class="progress-ring-fill" stroke-dasharray="314" stroke-dashoffset="157"></circle>
                            </svg>
                            <div class="progress-value">50%</div>
                        </div>
                        <div class="progress-label">Application Progress</div>
                    </div>
                    <div class="progress-card">
                        <div class="progress-ring">
                            <svg width="120" height="120">
                                <circle cx="60" cy="60" r="50" class="progress-ring-bg"></circle>
                                <circle cx="60" cy="60" r="50" class="progress-ring-fill" stroke-dasharray="314" stroke-dashoffset="94"></circle>
                            </svg>
                            <div class="progress-value">70%</div>
                        </div>
                        <div class="progress-label">Profile Complete</div>
                    </div>
                    <div class="progress-card">
                        <div class="progress-ring">
                            <svg width="120" height="120">
                                <circle cx="60" cy="60" r="50" class="progress-ring-bg"></circle>
                                <circle cx="60" cy="60" r="50" class="progress-ring-fill" stroke-dasharray="314" stroke-dashoffset="220"></circle>
                            </svg>
                            <div class="progress-value">30%</div>
                        </div>
                        <div class="progress-label">Essays Written</div>
                    </div>
                </div>
            </div>

            <!-- Compare -->
            <div id="compare-tab" class="tab-content" style="display:none;">
                <h2 style="margin-bottom: 20px;">In-State vs Out-of-State Analysis</h2>
                <div class="comparison-container">
                    <div class="comparison-card">
                        <div class="comparison-header"><div class="comparison-title">üè† In-State Option</div></div>
                        <div class="comparison-metric"><span class="metric-label">Average Tuition</span><span class="metric-value positive">$11,000/yr</span></div>
                        <div class="comparison-metric"><span class="metric-label">4-Year Total Cost</span><span class="metric-value">$64,000</span></div>
                        <div class="comparison-metric"><span class="metric-label">Travel Costs</span><span class="metric-value positive">$500/yr</span></div>
                        <div class="comparison-metric"><span class="metric-label">State Grants Available</span><span class="metric-value positive">$5,000/yr</span></div>
                        <div class="comparison-metric"><span class="metric-label">Family Proximity</span><span class="metric-value">&lt; 2 hours</span></div>
                        <div class="comparison-metric"><span class="metric-label">Residency Benefits</span><span class="metric-value positive">Yes</span></div>
                    </div>
                    <div class="comparison-card recommended">
                        <div class="comparison-header"><div class="comparison-title">‚úàÔ∏è Out-of-State Option</div><span class="comparison-badge">AI Recommended</span></div>
                        <div class="comparison-metric"><span class="metric-label">Average Tuition</span><span class="metric-value negative">$28,000/yr</span></div>
                        <div class="comparison-metric"><span class="metric-label">4-Year Total Cost</span><span class="metric-value">$132,000</span></div>
                        <div class="comparison-metric"><span class="metric-label">Travel Costs</span><span class="metric-value negative">$2,500/yr</span></div>
                        <div class="comparison-metric"><span class="metric-label">Merit Scholarships</span><span class="metric-value positive">$12,000/yr</span></div>
                        <div class="comparison-metric"><span class="metric-label">Career Network</span><span class="metric-value positive">National</span></div>
                        <div class="comparison-metric"><span class="metric-label">Program Ranking</span><span class="metric-value positive">Top 20</span></div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 style="margin-bottom: 15px;">üí° AI Insight</h3>
                    <p style="line-height: 1.6;">
                        Based on your profile, the out-of-state option could provide <strong>$68,000 more in lifetime earnings</strong> 
                        due to stronger program reputation and alumni network. The additional cost of $68,000 would be offset within 
                        3-5 years after graduation. Consider applying to both and comparing actual financial aid packages.
                    </p>
                    <button class="btn btn-primary" style="margin-top: 15px;" onclick="showDetailedComparison()">See Detailed Analysis ‚Üí</button>
                </div>
            </div>

            <!-- AI Assistant -->
            <div id="ai-assistant-tab" class="tab-content" style="display:none;">
                <div class="ai-chat-container">
                    <div class="chat-header">
                        <div class="chat-avatar">ü§ñ</div>
                        <div>
                            <div style="font-weight: 600;">AI College Assistant</div>
                            <div style="font-size: 12px; opacity: 0.8;">Powered by GPT-4</div>
                        </div>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <div class="message ai">
                            Hi! I'm your AI college assistant. I can help you with:
                            <br><br>
                            ‚Ä¢ Essay writing and review<br>
                            ‚Ä¢ School recommendations<br>
                            ‚Ä¢ Application strategy<br>
                            ‚Ä¢ Scholarship opportunities<br>
                            ‚Ä¢ Interview preparation<br>
                            <br>
                            What would you like to explore today?
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything about college..." onkeypress="handleChatEnter(event)">
                        <button class="chat-send" onclick="sendChatMessage()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Schools -->
            <div id="schools-tab" class="tab-content" style="display:none;">
                <div class="schools-grid">
                    <div class="school-card" onclick="viewSchool(1)">
                        <img src="https://images.unsplash.com/photo-1569330803634-e380c6b3d18f?w=400" alt="Harvard" class="school-image">
                        <div class="school-content">
                            <div class="school-name">Harvard University</div>
                            <div class="school-location">Cambridge, MA</div>
                            <div class="school-stats">
                                <div class="school-stat"><span class="stat-value">3%</span><span class="stat-label">Accept</span></div>
                                <div class="school-stat"><span class="stat-value">85%</span><span class="stat-label">Match</span></div>
                                <div class="school-stat"><span class="stat-value">$57K</span><span class="stat-label">Tuition</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="school-card" onclick="viewSchool(2)">
                        <img src="https://images.unsplash.com/photo-1562113367-a26dd523e0c5?w=400" alt="Stanford" class="school-image">
                        <div class="school-content">
                            <div class="school-name">Stanford University</div>
                            <div class="school-location">Stanford, CA</div>
                            <div class="school-stats">
                                <div class="school-stat"><span class="stat-value">4%</span><span class="stat-label">Accept</span></div>
                                <div class="school-stat"><span class="stat-value">78%</span><span class="stat-label">Match</span></div>
                                <div class="school-stat"><span class="stat-value">$56K</span><span class="stat-label">Tuition</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="school-card" onclick="viewSchool(3)">
                        <img src="https://images.unsplash.com/photo-1583223230879-9714f2e2b5b3?w=400" alt="UC Berkeley" class="school-image">
                        <div class="school-content">
                            <div class="school-name">UC Berkeley</div>
                            <div class="school-location">Berkeley, CA</div>
                            <div class="school-stats">
                                <div class="school-stat"><span class="stat-value">14%</span><span class="stat-label">Accept</span></div>
                                <div class="school-stat"><span class="stat-value">92%</span><span class="stat-label">Match</span></div>
                                <div class="school-stat"><span class="stat-value">$44K</span><span class="stat-label">Tuition</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Applications -->
            <div id="applications-tab" class="tab-content" style="display:none;">
                <div class="card">
                    <h3>Applications</h3>
                    <p style="color:var(--text-secondary)">Track and manage application submissions. (Auto-fed by Planning tasks.)</p>
                </div>
            </div>

            <!-- Scholarships -->
            <div id="scholarships-tab" class="tab-content" style="display:none;">
                <div class="card">
                    <h3>Scholarships</h3>
                    <p style="color:var(--text-secondary)">Scholarship finder and matches coming soon.</p>
                </div>
            </div>

            <!-- Community -->
            <div id="community-tab" class="tab-content" style="display:none;">
                <h2 style="margin-bottom: 20px;">Community Feed</h2>
                <div class="social-feed">
                    <div class="social-post">
                        <div class="social-avatar">JD</div>
                        <div class="social-content">
                            <div class="social-name">Jessica Davis</div>
                            <div class="social-text">Just got accepted to UCLA! üéâ Don't give up, your dream school is waiting!</div>
                            <div class="social-actions"><span class="social-action">‚ù§Ô∏è 234</span><span class="social-action">üí¨ 45</span><span class="social-action">‚ÜóÔ∏è Share</span></div>
                        </div>
                    </div>
                    <div class="social-post">
                        <div class="social-avatar">MR</div>
                        <div class="social-content">
                            <div class="social-name">Mike Rodriguez</div>
                            <div class="social-text">Pro tip: Start your essays early! I wrote 15 drafts of my Common App essay and it paid off.</div>
                            <div class="social-actions"><span class="social-action">‚ù§Ô∏è 156</span><span class="social-action">üí¨ 23</span><span class="social-action">‚ÜóÔ∏è Share</span></div>
                        </div>
                    </div>
                    <div class="social-post">
                        <div class="social-avatar">ST</div>
                        <div class="social-content">
                            <div class="social-name">Sarah Thompson</div>
                            <div class="social-text">Anyone else struggling with the "Why Us?" essays? Found this AI tool super helpful!</div>
                            <div class="social-actions"><span class="social-action">‚ù§Ô∏è 89</span><span class="social-action">üí¨ 67</span><span class="social-action">‚ÜóÔ∏è Share</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        /* =========================
           STATE
        ==========================*/
        const AppState = {
            user: null,
            schools: [],
            applications: [],
            messages: [],
            currentTab: 'planning',
            theme: 'dark',
            aiContext: [],
            streak: 0,
            lastCheckInISO: null
        };

        const API_CONFIG = {
            baseUrl: 'http://localhost:3000/api',
            openAIKey: null
        };

        /* =========================
           AI INTEGRATION
        ==========================*/
        async function sendToAI(message, context = {}) {
            try {
                const response = await fetch(`${API_CONFIG.baseUrl}/ai/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('userToken') || ''}`
                    },
                    body: JSON.stringify({
                        message,
                        context: {
                            user: AppState.user,
                            schools: AppState.schools,
                            planning: {
                                streak: AppState.streak,
                                applications: window.applicationTracker?.applications ?? []
                            },
                            previousMessages: AppState.aiContext.slice(-5),
                            ...context
                        }
                    })
                });
                const data = await response.json();
                return data.response || 'Okay!';
            } catch (err) {
                console.error('AI Error:', err);
                return 'Sorry, I\'m having trouble connecting. Please try again.';
            }
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text) return;

            const box = document.getElementById('chatMessages');
            box.innerHTML += `<div class="message user">${text}</div>`;
            box.innerHTML += `
              <div class="message ai typing" id="typingIndicator">
                <div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
              </div>`;
            box.scrollTop = box.scrollHeight;
            input.value = '';

            const reply = await sendToAI(text);
            const t = document.getElementById('typingIndicator'); if (t) t.remove();
            box.innerHTML += `<div class="message ai">${reply}</div>`;
            AppState.aiContext.push({ user: text, ai: reply });
            box.scrollTop = box.scrollHeight;
        }

        function handleChatEnter(e){ if(e.key==='Enter') sendChatMessage(); }

        /* =========================
           STATE COMPARISON ENGINE
           (unchanged logic from your code)
        ==========================*/
        class StateComparisonEngine {
            constructor(user){ this.user=user; }
            async compare(schoolId){
                const response = await fetch(`${API_CONFIG.baseUrl}/compare/state`, {
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({ schoolId, userState:this.user?.state, userProfile:this.user })
                });
                return await response.json();
            }
            calculate4YearCost(t, f, r, isIn){ const yearly=t+f+r; const travel=isIn?500:2500; return yearly*4 + travel*4; }
            calculateROI(s, isIn){
                const cost = this.calculate4YearCost(s.tuition, s.fees, s.roomBoard, isIn);
                const expected = s.graduateSalary;
                const roi = (expected*10 - cost) / cost;
                return Math.round(roi*100);
            }
            generateRecommendation(c){
                const factors = {
                    costDifference: c.outOfState.cost - c.inState.cost,
                    rankingDifference: c.inState.ranking - c.outOfState.ranking,
                    careerProspects: c.outOfState.careerScore - c.inState.careerScore
                };
                if (factors.costDifference < 20000 && factors.rankingDifference > 20)
                    return {recommendation:'out-of-state', reason:'The ranking difference justifies the additional cost'};
                if (factors.costDifference > 50000)
                    return {recommendation:'in-state', reason:'Significant cost savings with comparable outcomes'};
                return {recommendation:'both', reason:'Apply to both and compare financial aid packages'};
            }
        }

        /* =========================
           APPLICATION TRACKER (extended)
        ==========================*/
        class ApplicationTracker {
            constructor(){
                this.applications = JSON.parse(localStorage.getItem('applications') || '[]');
                this.deadlines = [];
                this.updateDeadlines();
            }
            addApplication(school){
                const app = {
                    id: Date.now(),
                    schoolId: school.id,
                    schoolName: school.name,
                    status: 'not-started',
                    deadline: school.deadline,
                    tasks: this.generateTasks(school),
                    documents: [], essays: [], submitted: false,
                    createdAt: new Date().toISOString(),
                    progress: 0
                };
                this.applications.push(app);
                this.persist(); this.updateDeadlines();
                return app;
            }
            generateTasks(s){
                return [
                    { name: 'Complete Common App', status: 'pending', required: true },
                    { name: 'Submit transcripts', status: 'pending', required: true },
                    { name: 'Request letters of recommendation', status: 'pending', required: true },
                    { name: 'Write supplemental essays', status: 'pending', required: !!s.hasSupplements },
                    { name: 'Submit test scores', status: 'pending', required: !s.testOptional },
                    { name: 'Complete CSS Profile', status: 'pending', required: !!s.requiresCSS },
                    { name: 'Submit application fee', status: 'pending', required: true }
                ];
            }
            updateTaskStatus(appId, taskName, status){
                const app = this.applications.find(a=>a.id===appId);
                if (!app) return;
                const task = app.tasks.find(t=>t.name===taskName);
                if (task){
                    task.status = status;
                    this.calculateProgress(app);
                    this.checkInStreak();
                    this.persist();
                    renderPlanningTab();
                }
            }
            calculateProgress(app){
                const completed = app.tasks.filter(t=>t.status==='completed' && t.required).length;
                const total = app.tasks.filter(t=>t.required).length || 1;
                app.progress = Math.round((completed/total)*100);
                return app.progress;
            }
            submitApplication(appId){
                const app = this.applications.find(a=>a.id===appId);
                if (app){
                    app.submitted = true;
                    this.persist();
                    renderPlanningTab();
                }
            }
            updateDeadlines(){
                this.deadlines = this.applications.map(app => {
                    const daysLeft = Math.ceil((new Date(app.deadline) - new Date()) / (1000*60*60*24));
                    return { appId: app.id, school: app.schoolName, deadline: app.deadline, daysLeft };
                }).sort((a,b)=>a.daysLeft - b.daysLeft);
            }
            getUpcomingDeadlines(days=30){ return this.deadlines.filter(d=>d.daysLeft<=days && d.daysLeft>0); }
            reset(){
                this.applications = []; this.deadlines=[]; AppState.streak = 0; AppState.lastCheckInISO=null;
                this.persist(); showToast("Planning reset complete!"); renderPlanningTab();
            }
            persist(){
                localStorage.setItem('applications', JSON.stringify(this.applications));
                localStorage.setItem('streak', String(AppState.streak));
                localStorage.setItem('lastCheckInISO', AppState.lastCheckInISO || '');
            }
            checkInStreak(){
                const today = new Date();
                const lastISO = AppState.lastCheckInISO;
                if (!lastISO) {
                    AppState.streak = 1;
                } else {
                    const last = new Date(lastISO);
                    const diffDays = Math.floor((today - new Date(last.toDateString()))/(1000*60*60*24));
                    if (diffDays === 1) AppState.streak += 1;
                    else if (diffDays > 1) AppState.streak = 1;
                }
                AppState.lastCheckInISO = new Date().toISOString();
                this.persist();
            }
        }

        /* =========================
           UI HELPERS
        ==========================*/
        function showTab(tabName, clickedBtn=null){
            document.querySelectorAll('.tab-content').forEach(t=>t.style.display='none');
            const panel = document.getElementById(`${tabName}-tab`);
            if (panel) panel.style.display = 'block';
            document.querySelectorAll('.nav-tab').forEach(b=>b.classList.remove('active'));
            if (clickedBtn) clickedBtn.classList.add('active');
            AppState.currentTab = tabName;
            if (tabName==='planning') renderPlanningTab();
        }
        function toggleTheme(){
            const cur = document.body.getAttribute('data-theme');
            const nxt = cur === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', nxt);
            AppState.theme = nxt; localStorage.setItem('theme', nxt);
        }
        function showOnboarding(){ showToast('Onboarding flow coming soon!'); }
        function showDetailedComparison(){ showToast('Detailed analysis loading...'); }
        function viewSchool(id){ showToast(`Viewing school ${id}`); }
        function showToast(msg){
            const t = document.createElement('div'); t.className='toast'; t.textContent=msg; document.body.appendChild(t);
            setTimeout(()=>{ t.classList.add('show'); setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=>t.remove(),300); },3000); },100);
        }

        /* Planning render + actions */
        function renderPlanningTab(){
            const tl = document.getElementById('taskList');
            const streakEl = document.getElementById('streakCount');
            const milestonesEl = document.getElementById('milestonesCount');
            const apps = window.applicationTracker.applications;
            const deadlines = window.applicationTracker.getUpcomingDeadlines(30);

            streakEl.textContent = `üî• ${AppState.streak} ${AppState.streak===1?'day':'days'}`;
            const submitted = apps.filter(a=>a.submitted).length;
            milestonesEl.textContent = `${submitted}/${apps.length}`;

            if (deadlines.length===0){
                tl.innerHTML = `<li>No tasks yet. Add a school to get started!</li>`;
            } else {
                tl.innerHTML = deadlines.map(d=>{
                    const app = apps.find(a=>a.id===d.appId);
                    const nextTask = app?.tasks.find(t=>t.required && t.status!=='completed');
                    const label = nextTask ? nextTask.name : 'All required tasks completed';
                    const done = !nextTask;
                    return `
                      <li class="${done?'completed':''}">
                        <span>${d.school} ‚Äî ${label} (due in ${d.daysLeft} days)</span>
                        ${ done
                            ? `<button class="task-action secondary" onclick="applicationTracker.submitApplication(${d.appId})">Mark Submitted</button>`
                            : `<button class="task-action" onclick="completeNextTask(${d.appId})">Mark Step Done</button>` }
                      </li>`;
                }).join('');
            }
        }
        function completeNextTask(appId){
            const app = window.applicationTracker.applications.find(a=>a.id===appId);
            if (!app) return;
            const nextTask = app.tasks.find(t=>t.required && t.status!=='completed');
            if (nextTask) {
                window.applicationTracker.updateTaskStatus(appId, nextTask.name, 'completed');
                showToast(`Completed: ${nextTask.name}`);
            } else {
                showToast('All required tasks already completed.');
            }
        }
        function resetPlanning(){ window.applicationTracker.reset(); }

        /* =========================
           INIT
        ==========================*/
        function init(){
            const theme = localStorage.getItem('theme') || 'dark';
            document.body.setAttribute('data-theme', theme);

            const savedUser = localStorage.getItem('user');
            if (savedUser) AppState.user = JSON.parse(savedUser);

            const savedStreak = parseInt(localStorage.getItem('streak') || '0', 10);
            const savedLast = localStorage.getItem('lastCheckInISO') || null;
            if (!isNaN(savedStreak)) AppState.streak = savedStreak;
            if (savedLast) AppState.lastCheckInISO = savedLast;

            window.stateComparison = new StateComparisonEngine(AppState.user);
            window.applicationTracker = new ApplicationTracker();

            // Default to Planning
            const firstBtn = document.querySelector('.nav-tab');
            showTab('planning', firstBtn);
        }
        document.addEventListener('DOMContentLoaded', init);
    </script>

    <!-- =========================
         EMBEDDED TESTS (in-browser)
         Open DevTools ‚Üí Console to view results.
    ==========================-->
    <script type="module">
        const log = (...a)=>console.log('%c[Test]', 'color:#00b894;font-weight:bold;', ...a);
        const fail = (m)=>{ console.error('[Test FAIL]', m); throw new Error(m); };
        const assert = (cond, m)=>{ if(!cond) fail(m); };

        async function runTests(){
            try{
                // Reset localStorage to avoid flakiness between reloads
                localStorage.clear();

                // Re-init app
                if (window.applicationTracker) { /* nop */ }
                window.applicationTracker = new ApplicationTracker();

                log('1) addApplication() creates app + tasks');
                const in7 = new Date(Date.now()+7*24*60*60*1000).toISOString();
                const app = applicationTracker.addApplication({ id:1, name:'Test U', deadline:in7, hasSupplements:true, testOptional:false, requiresCSS:true });
                assert(applicationTracker.applications.length===1, 'App count should be 1');
                assert(app.tasks.length>=5, 'Should generate multiple tasks');

                log('2) updateTaskStatus() marks task completed + updates progress');
                applicationTracker.updateTaskStatus(app.id, 'Complete Common App', 'completed');
                const t1 = app.tasks.find(t=>t.name==='Complete Common App');
                assert(t1 && t1.status==='completed', 'Task should be completed');
                assert(app.progress>0, 'Progress should be > 0');

                log('3) streak logic increments on activity day-over-day');
                AppState.streak = 1;
                AppState.lastCheckInISO = new Date(Date.now()-24*60*60*1000).toISOString(); // yesterday
                applicationTracker.checkInStreak();
                assert(AppState.streak===2, 'Streak should become 2');

                log('4) getUpcomingDeadlines() filters within 30 days');
                applicationTracker.updateDeadlines();
                const list = applicationTracker.getUpcomingDeadlines(30);
                assert(list.length>=1, 'Upcoming should contain the added app');

                log('5) submitApplication() marks milestone');
                applicationTracker.submitApplication(app.id);
                assert(app.submitted===true, 'App should be submitted');

                log('6) reset() clears apps and streak');
                applicationTracker.reset();
                assert(applicationTracker.applications.length===0, 'Apps cleared');
                assert(parseInt(localStorage.getItem('streak')||'0',10)===0, 'Streak cleared');

                log('7) showTab() activates correct panel & button');
                // Create a fake button to click
                const navBtn = document.querySelector('.nav-tab:nth-child(2)'); // Dashboard
                showTab('dashboard', navBtn);
                const panel = document.getElementById('dashboard-tab');
                assert(panel.style.display==='block', 'Dashboard should be visible');
                assert(navBtn.classList.contains('active'), 'Dashboard button active');

                log('‚úÖ All embedded tests passed!');
            } catch (e) {
                console.error(e);
            }
        }
        // Delay until main has initialized DOM
        window.addEventListener('load', ()=>setTimeout(runTests, 100));
    </script>
</body>
</html>
