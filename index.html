<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Pathwise ‚Äî Your College Journey</title>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="theme-color" content="#667eea" />

<style>
  /* Modern Design System */
  :root {
    --bg: #fafbfc;
    --bg-secondary: #f3f4f6;
    --card: rgba(255, 255, 255, 0.95);
    --card-hover: rgba(255, 255, 255, 1);
    --ink: #0f172a;
    --ink-secondary: #475569;
    --muted: #64748b;
    --border: rgba(15, 23, 42, 0.08);
    
    /* Brand Colors */
    --primary: #667eea;
    --primary-dark: #5a67d8;
    --secondary: #f56565;
    --accent: #48bb78;
    --warning: #ed8936;
    --danger: #f56565;
    --success: #48bb78;
    
    /* Gradients */
    --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --gradient-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    --gradient-warm: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    
    /* Effects */
    --glass: rgba(255, 255, 255, 0.7);
    --glass-dark: rgba(17, 24, 39, 0.7);
    --blur: 20px;
    --shadow-sm: 0 2px 8px rgba(15, 23, 42, 0.08);
    --shadow: 0 10px 30px rgba(15, 23, 42, 0.12);
    --shadow-lg: 0 20px 60px rgba(15, 23, 42, 0.15);
    --shadow-xl: 0 25px 80px rgba(15, 23, 42, 0.18);
    --shadow-colored: 0 20px 60px rgba(102, 126, 234, 0.25);
    
    /* Spacing & Sizing */
    --radius: 16px;
    --radius-lg: 24px;
    --radius-xl: 32px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    
    /* Z-index layers */
    --z-base: 0;
    --z-dropdown: 100;
    --z-sticky: 200;
    --z-overlay: 300;
    --z-modal: 400;
    --z-toast: 500;
  }

  /* Dark theme */
  [data-theme="dark"] {
    --bg: #0f1419;
    --bg-secondary: #1a1f2e;
    --card: rgba(26, 31, 46, 0.95);
    --card-hover: rgba(26, 31, 46, 1);
    --ink: #f8fafc;
    --ink-secondary: #cbd5e1;
    --muted: #94a3b8;
    --border: rgba(148, 163, 184, 0.1);
    --glass: rgba(26, 31, 46, 0.7);
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
    --shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.5);
    --shadow-colored: 0 20px 60px rgba(102, 126, 234, 0.15);
  }

  /* Reset & Base */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    height: 100%;
    scroll-behavior: smooth;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    height: 100%;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Inter", "Helvetica Neue", sans-serif;
    font-size: 16px;
    line-height: 1.6;
    color: var(--ink);
    background: var(--bg);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    position: relative;
    overflow-x: hidden;
  }

  /* Animated Background */
  .bg-animation {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    opacity: 0.03;
    pointer-events: none;
  }

  .bg-animation::before,
  .bg-animation::after {
    content: '';
    position: absolute;
    width: 400px;
    height: 400px;
    border-radius: 50%;
    background: var(--gradient-primary);
    animation: float 20s ease-in-out infinite;
  }

  .bg-animation::before {
    top: -200px;
    left: -200px;
    animation-delay: 0s;
  }

  .bg-animation::after {
    bottom: -200px;
    right: -200px;
    animation-delay: 10s;
  }

  @keyframes float {
    0%, 100% { transform: translate(0, 0) rotate(0deg); }
    33% { transform: translate(100px, 100px) rotate(120deg); }
    66% { transform: translate(-100px, 50px) rotate(240deg); }
  }

  /* Typography */
  h1, h2, h3, h4, h5, h6 {
    font-weight: 700;
    line-height: 1.3;
    letter-spacing: -0.02em;
  }

  h1 { font-size: 2.5rem; }
  h2 { font-size: 2rem; }
  h3 { font-size: 1.5rem; }
  h4 { font-size: 1.25rem; }
  h5 { font-size: 1.125rem; }

  @media (max-width: 640px) {
    h1 { font-size: 2rem; }
    h2 { font-size: 1.5rem; }
    h3 { font-size: 1.25rem; }
  }

  /* Header */
  .header {
    position: sticky;
    top: 0;
    z-index: var(--z-sticky);
    backdrop-filter: blur(var(--blur));
    -webkit-backdrop-filter: blur(var(--blur));
    background: var(--glass);
    border-bottom: 1px solid var(--border);
    transition: var(--transition);
  }

  .header-inner {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }

  .brand {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-weight: 800;
    font-size: 1.25rem;
    cursor: pointer;
    transition: var(--transition-fast);
  }

  .brand:hover {
    transform: translateY(-1px);
  }

  .brand-logo {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    background: var(--gradient-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    box-shadow: var(--shadow-sm);
    animation: pulse 2s ease infinite;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  .header-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  /* Buttons */
  .btn {
    appearance: none;
    border: none;
    outline: none;
    background: var(--card);
    color: var(--ink);
    font-family: inherit;
    font-size: 0.9rem;
    font-weight: 600;
    padding: 0.75rem 1.25rem;
    border-radius: var(--radius);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    transition: var(--transition);
    box-shadow: var(--shadow-sm);
    user-select: none;
    position: relative;
    overflow: hidden;
    min-height: 44px;
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
  }

  .btn:active {
    transform: translateY(0);
    box-shadow: var(--shadow-sm);
  }

  .btn:focus-visible {
    outline: 3px solid var(--primary);
    outline-offset: 2px;
  }

  .btn.primary {
    background: var(--gradient-primary);
    color: white;
    box-shadow: var(--shadow-colored);
    animation: gradient-shift 3s ease infinite;
    background-size: 200% 200%;
  }

  @keyframes gradient-shift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  .btn.secondary {
    background: var(--gradient-secondary);
    color: white;
  }

  .btn.success {
    background: var(--gradient-success);
    color: white;
  }

  .btn.ghost {
    background: transparent;
    box-shadow: none;
    border: 2px solid var(--border);
  }

  .btn.icon {
    padding: 0.75rem;
    min-width: 44px;
  }

  .btn.danger {
    background: var(--gradient-secondary);
    color: white;
  }

  .btn.disabled,
  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }

  /* Ripple Effect */
  .btn::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    transform: translate(-50%, -50%);
    transition: width 0.5s, height 0.5s;
  }

  .btn:active::after {
    width: 300px;
    height: 300px;
  }

  /* Main Container */
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1.5rem 1rem;
  }

  /* Cards */
  .card {
    background: var(--card);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
  }

  .card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
  }

  .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-primary);
    opacity: 0;
    transition: opacity 0.3s;
  }

  .card:hover::before {
    opacity: 1;
  }

  /* Grid System */
  .grid {
    display: grid;
    gap: 1rem;
  }

  @media (min-width: 640px) {
    .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
    .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
    .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
  }

  @media (min-width: 1024px) {
    .lg\:grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
    .lg\:grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
  }

  /* Form Elements */
  .field {
    margin-bottom: 1.25rem;
  }

  .field label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--ink-secondary);
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }

  .field input,
  .field select,
  .field textarea {
    width: 100%;
    padding: 0.875rem 1rem;
    font-size: 1rem;
    font-family: inherit;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    background: var(--bg-secondary);
    color: var(--ink);
    transition: var(--transition-fast);
    outline: none;
    min-height: 44px;
  }

  .field input:focus,
  .field select:focus,
  .field textarea:focus {
    border-color: var(--primary);
    background: var(--card);
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
  }

  .field.error input,
  .field.error select {
    border-color: var(--danger);
    background: rgba(245, 101, 101, 0.05);
  }

  .field .error-msg {
    color: var(--danger);
    font-size: 0.875rem;
    margin-top: 0.25rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    animation: shake 0.5s;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
  }

  .field .helper-text {
    color: var(--muted);
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }

  /* Checkbox & Radio */
  .checkbox-wrapper,
  .radio-wrapper {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: var(--radius);
    transition: var(--transition-fast);
  }

  .checkbox-wrapper:hover,
  .radio-wrapper:hover {
    background: var(--bg-secondary);
  }

  .checkbox-wrapper input[type="checkbox"],
  .radio-wrapper input[type="radio"] {
    width: 20px;
    height: 20px;
    accent-color: var(--primary);
    cursor: pointer;
  }

  /* Tabs */
  .tabs {
    display: flex;
    gap: 0.5rem;
    padding: 0.5rem;
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    overflow-x: auto;
    margin-bottom: 1.5rem;
    scrollbar-width: none;
    -webkit-overflow-scrolling: touch;
  }

  .tabs::-webkit-scrollbar {
    display: none;
  }

  .tab {
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius);
    background: transparent;
    color: var(--muted);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    white-space: nowrap;
    position: relative;
    user-select: none;
    min-height: 44px;
    display: flex;
    align-items: center;
  }

  .tab:hover {
    background: var(--card);
    color: var(--ink);
  }

  .tab.active {
    background: var(--gradient-primary);
    color: white;
    box-shadow: var(--shadow-colored);
  }

  /* Badges & Pills */
  .badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.375rem 0.75rem;
    border-radius: 999px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }

  .badge.reach {
    background: rgba(245, 101, 101, 0.15);
    color: var(--danger);
  }

  .badge.match {
    background: rgba(72, 187, 120, 0.15);
    color: var(--success);
  }

  .badge.safety {
    background: rgba(102, 126, 234, 0.15);
    color: var(--primary);
  }

  .pill {
    position: absolute;
    top: 1rem;
    right: 1rem;
    padding: 0.375rem 0.75rem;
    border-radius: 999px;
    background: var(--gradient-primary);
    color: white;
    font-size: 0.75rem;
    font-weight: 700;
    box-shadow: var(--shadow-sm);
  }

  /* School Cards */
  .school-card {
    background: var(--card);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    border: 1px solid var(--border);
    box-shadow: var(--shadow-sm);
    transition: var(--transition);
    position: relative;
    cursor: pointer;
    overflow: hidden;
  }

  .school-card:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary);
  }

  .school-card h4 {
    margin-bottom: 0.5rem;
    color: var(--ink);
  }

  .school-meta {
    color: var(--muted);
    font-size: 0.875rem;
    margin-bottom: 0.75rem;
  }

  .school-stats {
    display: flex;
    gap: 1rem;
    margin: 0.75rem 0;
    padding: 0.75rem;
    background: var(--bg-secondary);
    border-radius: var(--radius);
  }

  .stat-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .stat-label {
    font-size: 0.75rem;
    color: var(--muted);
    text-transform: uppercase;
  }

  .stat-value {
    font-weight: 700;
    color: var(--ink);
  }

  .school-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
  }

  /* Progress Components */
  .progress-ring {
    width: 80px;
    height: 80px;
  }

  .progress-ring circle {
    transition: stroke-dashoffset 0.5s ease;
  }

  .progress-text {
    font-size: 1.25rem;
    font-weight: 700;
    fill: var(--ink);
  }

  .progress-bar {
    height: 8px;
    background: var(--bg-secondary);
    border-radius: 999px;
    overflow: hidden;
    position: relative;
  }

  .progress-bar-fill {
    height: 100%;
    background: var(--gradient-primary);
    border-radius: 999px;
    transition: width 0.5s ease;
    position: relative;
    overflow: hidden;
  }

  .progress-bar-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* Timeline */
  .timeline {
    position: relative;
    padding-left: 2rem;
  }

  .timeline::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--border);
  }

  .timeline-item {
    position: relative;
    padding: 1rem;
    margin-bottom: 1rem;
    background: var(--card);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    transition: var(--transition);
  }

  .timeline-item:hover {
    transform: translateX(4px);
    box-shadow: var(--shadow);
  }

  .timeline-item::before {
    content: '';
    position: absolute;
    left: -2rem;
    top: 50%;
    transform: translateY(-50%);
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--primary);
    border: 2px solid var(--bg);
    z-index: 1;
  }

  .timeline-item.urgent-high::before {
    background: var(--danger);
    animation: pulse-danger 1s infinite;
  }

  @keyframes pulse-danger {
    0%, 100% { box-shadow: 0 0 0 0 rgba(245, 101, 101, 0.7); }
    50% { box-shadow: 0 0 0 8px rgba(245, 101, 101, 0); }
  }

  .timeline-item.urgent-medium::before {
    background: var(--warning);
  }

  .timeline-item.urgent-low::before {
    background: var(--success);
  }

  /* Empty States */
  .empty-state {
    text-align: center;
    padding: 3rem 1.5rem;
  }

  .empty-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    animation: bounce 2s ease infinite;
  }

  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  .empty-state h3 {
    color: var(--ink);
    margin-bottom: 0.5rem;
  }

  .empty-state p {
    color: var(--muted);
    margin-bottom: 1.5rem;
  }

  /* Modals */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    z-index: var(--z-modal);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
  }

  .modal-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .modal {
    background: var(--card);
    border-radius: var(--radius-xl);
    padding: 2rem;
    max-width: 500px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-xl);
    transform: scale(0.9);
    transition: transform 0.3s;
  }

  .modal-overlay.active .modal {
    transform: scale(1);
  }

  /* Toast Notifications */
  .toast-container {
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: var(--z-toast);
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    pointer-events: none;
  }

  .toast {
    background: var(--card);
    padding: 1rem 1.5rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow-lg);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    min-width: 250px;
    pointer-events: auto;
    transform: translateX(400px);
    transition: transform 0.3s;
    border-left: 4px solid var(--primary);
  }

  .toast.show {
    transform: translateX(0);
  }

  .toast.success {
    border-left-color: var(--success);
  }

  .toast.error {
    border-left-color: var(--danger);
  }

  .toast.warning {
    border-left-color: var(--warning);
  }

  /* AI Assistant */
  .ai-bubble {
    position: fixed;
    right: 1.5rem;
    bottom: 1.5rem;
    z-index: var(--z-overlay);
    background: var(--gradient-primary);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-xl);
    cursor: pointer;
    transition: var(--transition);
    animation: slide-up 0.5s ease;
    max-width: 300px;
  }

  .ai-bubble:hover {
    transform: translateY(-4px);
    box-shadow: 0 30px 80px rgba(102, 126, 234, 0.3);
  }

  .ai-bubble.minimized {
    width: 60px;
    height: 60px;
    padding: 0;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
  }

  @keyframes slide-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Achievements */
  .achievement {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--card);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    margin-bottom: 0.75rem;
    transition: var(--transition);
    animation: slide-in 0.5s ease;
  }

  @keyframes slide-in {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .achievement-icon {
    font-size: 2rem;
  }

  .achievement-content h4 {
    margin-bottom: 0.25rem;
  }

  .achievement-content p {
    color: var(--muted);
    font-size: 0.875rem;
  }

  .achievement.new {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    border-color: var(--primary);
  }

  /* Confetti */
  .confetti-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: var(--z-toast);
  }

  .confetti {
    position: absolute;
    width: 10px;
    height: 10px;
    background: var(--primary);
    animation: confetti-fall 3s ease-out forwards;
  }

  @keyframes confetti-fall {
    0% {
      transform: translateY(-100vh) rotate(0deg);
      opacity: 1;
    }
    100% {
      transform: translateY(100vh) rotate(720deg);
      opacity: 0;
    }
  }

  /* Loading States */
  .skeleton {
    background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border) 50%, var(--bg-secondary) 75%);
    background-size: 200% 100%;
    animation: skeleton-loading 1.5s infinite;
    border-radius: var(--radius);
  }

  @keyframes skeleton-loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  /* Utilities */
  .hidden { display: none !important; }
  .flex { display: flex; }
  .flex-col { flex-direction: column; }
  .items-center { align-items: center; }
  .justify-between { justify-content: space-between; }
  .justify-center { justify-content: center; }
  .gap-1 { gap: 0.25rem; }
  .gap-2 { gap: 0.5rem; }
  .gap-3 { gap: 0.75rem; }
  .gap-4 { gap: 1rem; }
  .mt-2 { margin-top: 0.5rem; }
  .mt-4 { margin-top: 1rem; }
  .mt-6 { margin-top: 1.5rem; }
  .mb-4 { margin-bottom: 1rem; }
  .text-center { text-align: center; }
  .text-muted { color: var(--muted); }
  .font-bold { font-weight: 700; }
  .text-sm { font-size: 0.875rem; }
  .text-lg { font-size: 1.125rem; }
  .w-full { width: 100%; }

  /* Responsive */
  @media (max-width: 640px) {
    .container {
      padding: 1rem 0.75rem;
    }
    
    .card {
      padding: 1.25rem;
    }
    
    .hide-mobile {
      display: none;
    }
    
    .school-stats {
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .tabs {
      padding: 0.375rem;
    }
    
    .tab {
      padding: 0.625rem 1rem;
      font-size: 0.875rem;
    }
  }

  /* Print Styles */
  @media print {
    body {
      background: white;
      color: black;
    }
    
    .header,
    .ai-bubble,
    .toast-container {
      display: none;
    }
    
    .card {
      box-shadow: none;
      border: 1px solid #ddd;
      page-break-inside: avoid;
    }
  }

  /* Accessibility */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* Focus Management */
  :focus-visible {
    outline: 3px solid var(--primary);
    outline-offset: 2px;
  }

  /* Reduced Motion */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }
</style>
</head>
<body>

<!-- Background Animation -->
<div class="bg-animation" aria-hidden="true"></div>

<!-- Header -->
<header class="header" role="banner">
  <div class="header-inner">
    <div class="brand" role="button" tabindex="0" aria-label="Pathwise Home">
      <div class="brand-logo" aria-hidden="true">üéì</div>
      <span>Pathwise</span>
    </div>
    <nav class="header-actions" role="navigation" aria-label="Main navigation">
      <button id="backBtn" class="btn ghost hidden" aria-label="Back to planning">
        <span aria-hidden="true">‚Üê</span> Back
      </button>
      <button id="profileBtn" class="btn icon" aria-label="Profile">üë§</button>
      <button id="themeBtn" class="btn icon" aria-label="Toggle theme">üåô</button>
      <button id="resetBtn" class="btn icon danger" aria-label="Reset all data">üîÑ</button>
    </nav>
  </div>
</header>

<!-- Main Content -->
<main class="container" role="main">

  <!-- Planning Section -->
  <section id="planningSection" aria-label="College planning form">
    <div class="card">
      <h1>Plan Your College Journey</h1>
      <p class="text-muted mb-4">We'll match you with perfect schools and track everything for you.</p>
      
      <form id="planningForm" novalidate>
        <div class="grid grid-cols-2 gap-4">
          <div class="field">
            <label for="firstName">First Name *</label>
            <input type="text" id="firstName" name="firstName" required aria-required="true" autocomplete="given-name">
            <span class="helper-text">How should we call you?</span>
          </div>
          
          <div class="field">
            <label for="grade">Current Grade *</label>
            <select id="grade" name="grade" required aria-required="true">
              <option value="">Select grade...</option>
              <option value="9">9th Grade</option>
              <option value="10">10th Grade</option>
              <option value="11">11th Grade</option>
              <option value="12">12th Grade</option>
              <option value="transfer">Transfer Student</option>
              <option value="gap">Gap Year</option>
            </select>
          </div>
          
          <div class="field">
            <label for="homeState">Home State *</label>
            <select id="homeState" name="homeState" required aria-required="true">
              <option value="">Select state...</option>
              <option value="CA">California</option>
              <option value="NY">New York</option>
              <option value="TX">Texas</option>
              <option value="MA">Massachusetts</option>
              <option value="IL">Illinois</option>
              <option value="FL">Florida</option>
              <option value="PA">Pennsylvania</option>
              <option value="other">Other State</option>
            </select>
          </div>
          
          <div class="field">
            <label for="income">Household Income (optional)</label>
            <input type="number" id="income" name="income" min="0" step="5000" placeholder="75000">
            <span class="helper-text">Helps estimate financial aid</span>
          </div>
          
          <div class="field">
            <label for="gpa">GPA</label>
            <input type="number" id="gpa" name="gpa" min="0" max="5" step="0.01" placeholder="3.85">
            <span class="helper-text">Weighted or unweighted</span>
          </div>
          
          <div class="field">
            <label for="sat">SAT Score (optional)</label>
            <input type="number" id="sat" name="sat" min="400" max="1600" step="10" placeholder="1400">
            <span class="helper-text">Many schools are test-optional</span>
          </div>
          
          <div class="field">
            <label for="ap">AP/Honors Courses</label>
            <input type="number" id="ap" name="ap" min="0" max="30" placeholder="5">
            <span class="helper-text">Total count taken or planned</span>
          </div>
          
          <div class="field">
            <label for="interests">Academic Interests</label>
            <select id="interests" name="interests">
              <option value="">Not sure yet...</option>
              <option value="stem">STEM (Science, Tech, Engineering, Math)</option>
              <option value="business">Business & Economics</option>
              <option value="arts">Arts & Design</option>
              <option value="humanities">Humanities & Social Sciences</option>
              <option value="health">Health & Medicine</option>
              <option value="education">Education</option>
            </select>
          </div>
        </div>
        
        <div class="flex gap-3 mt-6">
          <button type="submit" class="btn primary">
            Find My Matches <span aria-hidden="true">‚Üí</span>
          </button>
          <div id="matchCounter" class="badge" aria-live="polite">0 potential matches</div>
        </div>
      </form>
    </div>
    
    <!-- Achievement Notifications -->
    <div id="achievementsContainer" class="mt-6" aria-live="polite"></div>
  </section>

  <!-- Dashboard Section -->
  <section id="dashboardSection" class="hidden" aria-label="College application dashboard">
    
    <!-- Stats Cards -->
    <div class="grid grid-cols-3 gap-4 mb-6">
      <div class="card">
        <div class="text-muted text-sm">Profile Strength</div>
        <div class="flex items-center gap-3 mt-2">
          <svg width="60" height="60" class="progress-ring">
            <defs>
              <linearGradient id="gradient">
                <stop offset="0%" stop-color="#667eea"/>
                <stop offset="100%" stop-color="#764ba2"/>
              </linearGradient>
            </defs>
            <circle r="25" cx="30" cy="30" fill="transparent" stroke="var(--border)" stroke-width="5"/>
            <circle id="profileProgress" r="25" cx="30" cy="30" fill="transparent" stroke="url(#gradient)" 
                    stroke-width="5" stroke-dasharray="157" stroke-dashoffset="157" 
                    transform="rotate(-90 30 30)" stroke-linecap="round"/>
            <text x="30" y="35" text-anchor="middle" class="progress-text" id="profilePercent">0%</text>
          </svg>
        </div>
      </div>
      
      <div class="card">
        <div class="text-muted text-sm">Schools Added</div>
        <div class="text-lg font-bold mt-2" id="schoolCount">0</div>
        <div class="progress-bar mt-2">
          <div class="progress-bar-fill" id="schoolProgress" style="width: 0%"></div>
        </div>
      </div>
      
      <div class="card">
        <div class="text-muted text-sm">Days Until Deadline</div>
        <div class="text-lg font-bold mt-2" id="daysLeft">--</div>
        <div class="text-sm text-muted" id="nextDeadline">No deadlines set</div>
      </div>
    </div>
    
    <!-- Navigation Tabs -->
    <nav class="tabs" role="tablist" aria-label="Dashboard sections">
      <button role="tab" class="tab active" data-tab="schools" aria-selected="true">Schools</button>
      <button role="tab" class="tab" data-tab="financial" aria-selected="false">Financial Aid</button>
      <button role="tab" class="tab" data-tab="documents" aria-selected="false">Documents</button>
      <button role="tab" class="tab" data-tab="timeline" aria-selected="false">Timeline</button>
      <button role="tab" class="tab" data-tab="insights" aria-selected="false">Insights</button>
    </nav>
    
    <!-- Tab Content -->
    <div class="tab-content">
      
      <!-- Schools Tab -->
      <div id="schoolsTab" role="tabpanel" aria-labelledby="schools-tab">
        <div class="card mb-4">
          <h2>Find Your Perfect Schools</h2>
          
          <!-- Filters -->
          <div class="grid grid-cols-3 gap-3 mt-4">
            <div class="field">
              <label for="filterState">State</label>
              <select id="filterState">
                <option value="">All States</option>
                <option value="CA">California</option>
                <option value="NY">New York</option>
                <option value="TX">Texas</option>
                <option value="MA">Massachusetts</option>
                <option value="IL">Illinois</option>
              </select>
            </div>
            
            <div class="field">
              <label for="filterType">School Type</label>
              <select id="filterType">
                <option value="">All Types</option>
                <option value="public">Public</option>
                <option value="private">Private</option>
                <option value="UC">UC System</option>
                <option value="CSU">CSU System</option>
              </select>
            </div>
            
            <div class="field">
              <label for="searchSchool">Search</label>
              <input type="text" id="searchSchool" placeholder="School name or city...">
            </div>
          </div>
        </div>
        
        <!-- School Categories -->
        <div id="schoolCategories">
          <div class="mb-6">
            <h3 class="flex items-center gap-2 mb-3">
              <span class="badge reach">REACH</span>
              Dream big - these are ambitious choices
            </h3>
            <div id="reachSchools" class="grid grid-cols-3 gap-3"></div>
          </div>
          
          <div class="mb-6">
            <h3 class="flex items-center gap-2 mb-3">
              <span class="badge match">MATCH</span>
              Great fit - you're right in the range
            </h3>
            <div id="matchSchools" class="grid grid-cols-3 gap-3"></div>
          </div>
          
          <div class="mb-6">
            <h3 class="flex items-center gap-2 mb-3">
              <span class="badge safety">SAFETY</span>
              Solid options - high acceptance chances
            </h3>
            <div id="safetySchools" class="grid grid-cols-3 gap-3"></div>
          </div>
        </div>
        
        <!-- My Schools List -->
        <div class="card">
          <h3>My School List</h3>
          <div id="mySchoolsList" class="mt-4"></div>
        </div>
      </div>
      
      <!-- Financial Aid Tab -->
      <div id="financialTab" class="hidden" role="tabpanel" aria-labelledby="financial-tab">
        <div class="card">
          <h2>Financial Aid Estimates</h2>
          <p class="text-muted mb-4">Based on your profile and each school's aid programs.</p>
          <div id="aidEstimates"></div>
        </div>
      </div>
      
      <!-- Documents Tab -->
      <div id="documentsTab" class="hidden" role="tabpanel" aria-labelledby="documents-tab">
        <div class="card">
          <h2>Application Documents</h2>
          <div class="flex justify-between items-center mb-4">
            <p class="text-muted">Track all your requirements in one place.</p>
            <div class="badge" id="docProgress">0% Complete</div>
          </div>
          <div id="documentsList"></div>
        </div>
      </div>
      
      <!-- Timeline Tab -->
      <div id="timelineTab" class="hidden" role="tabpanel" aria-labelledby="timeline-tab">
        <div class="card">
          <h2>Application Timeline</h2>
          <p class="text-muted mb-4">Never miss a deadline.</p>
          <div class="timeline" id="timelineList"></div>
        </div>
      </div>
      
      <!-- Insights Tab -->
      <div id="insightsTab" class="hidden" role="tabpanel" aria-labelledby="insights-tab">
        <div class="card">
          <h2>Your Insights</h2>
          <div id="insightsContent"></div>
        </div>
      </div>
    </div>
  </section>

</main>

<!-- AI Assistant Bubble -->
<div id="aiBubble" class="ai-bubble hidden" role="button" tabindex="0" aria-label="AI Assistant">
  <p id="aiMessage">Need help picking schools? I'm here to guide you! üéØ</p>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>

<!-- Profile Modal -->
<div class="modal-overlay" id="profileModal" role="dialog" aria-modal="true" aria-labelledby="profileTitle">
  <div class="modal">
    <h2 id="profileTitle">Your Profile</h2>
    <div id="profileContent"></div>
    <button class="btn ghost mt-4" onclick="closeModal('profileModal')">Close</button>
  </div>
</div>

<script>
// ============================================
// ENHANCED PATHWISE APPLICATION
// ============================================

// State Management System
class AppState {
  constructor() {
    this.state = {
      user: null,
      schools: [],
      mySchools: [],
      documents: {},
      achievements: [],
      filters: {
        state: '',
        type: '',
        search: ''
      },
      ui: {
        currentSection: 'planning',
        currentTab: 'schools',
        theme: 'light'
      }
    };
    this.listeners = new Map();
    this.loadState();
  }

  subscribe(key, callback) {
    if (!this.listeners.has(key)) {
      this.listeners.set(key, new Set());
    }
    this.listeners.get(key).add(callback);
    return () => this.listeners.get(key).delete(callback);
  }

  update(key, value) {
    const oldValue = this.getNestedValue(key);
    this.setNestedValue(key, value);
    this.notify(key, value, oldValue);
    this.persist();
  }

  get(key) {
    return this.getNestedValue(key);
  }

  notify(key, newValue, oldValue) {
    if (this.listeners.has(key)) {
      this.listeners.get(key).forEach(cb => cb(newValue, oldValue));
    }
  }

  getNestedValue(path) {
    return path.split('.').reduce((obj, key) => obj?.[key], this.state);
  }

  setNestedValue(path, value) {
    const keys = path.split('.');
    const lastKey = keys.pop();
    const target = keys.reduce((obj, key) => {
      if (!obj[key]) obj[key] = {};
      return obj[key];
    }, this.state);
    target[lastKey] = value;
  }

  persist() {
    try {
      localStorage.setItem('pathwise_state', JSON.stringify(this.state));
    } catch (e) {
      if (e.name === 'QuotaExceededError') {
        this.handleStorageQuotaExceeded();
      }
      console.error('Failed to save state:', e);
    }
  }

  loadState() {
    try {
      const saved = localStorage.getItem('pathwise_state');
      if (saved) {
        this.state = { ...this.state, ...JSON.parse(saved) };
      }
    } catch (e) {
      console.error('Failed to load state:', e);
    }
  }

  handleStorageQuotaExceeded() {
    Toast.show('Storage full. Some data may not be saved.', 'warning');
    // Implement cleanup logic
  }

  reset() {
    const theme = this.state.ui.theme;
    this.state = {
      user: null,
      schools: [],
      mySchools: [],
      documents: {},
      achievements: [],
      filters: { state: '', type: '', search: '' },
      ui: { currentSection: 'planning', currentTab: 'schools', theme }
    };
    localStorage.removeItem('pathwise_state');
    this.persist();
    location.reload();
  }
}

// School Database
const SCHOOLS_DB = [
  // UC System
  {id:'ucb',name:'UC Berkeley',state:'CA',system:'UC',type:'public',city:'Berkeley',avgGPA:4.25,avgSAT:1450,acceptRate:14.5,tuitionIn:14226,tuitionOut:46770,rank:22,size:'large',setting:'urban'},
  {id:'ucla',name:'UCLA',state:'CA',system:'UC',type:'public',city:'Los Angeles',avgGPA:4.26,avgSAT:1445,acceptRate:12.3,tuitionIn:13401,tuitionOut:45975,rank:20,size:'large',setting:'urban'},
  {id:'ucsd',name:'UC San Diego',state:'CA',system:'UC',type:'public',city:'La Jolla',avgGPA:4.16,avgSAT:1410,acceptRate:31.5,tuitionIn:14616,tuitionOut:47190,rank:34,size:'large',setting:'suburban'},
  {id:'ucd',name:'UC Davis',state:'CA',system:'UC',type:'public',city:'Davis',avgGPA:4.13,avgSAT:1350,acceptRate:37.6,tuitionIn:14597,tuitionOut:47171,rank:38,size:'large',setting:'suburban'},
  {id:'uci',name:'UC Irvine',state:'CA',system:'UC',type:'public',city:'Irvine',avgGPA:4.08,avgSAT:1360,acceptRate:26.5,tuitionIn:13727,tuitionOut:46301,rank:36,size:'large',setting:'suburban'},
  {id:'ucsb',name:'UC Santa Barbara',state:'CA',system:'UC',type:'public',city:'Santa Barbara',avgGPA:4.15,avgSAT:1380,acceptRate:29.6,tuitionIn:14391,tuitionOut:46965,rank:32,size:'large',setting:'suburban'},
  
  // CSU System
  {id:'cpslo',name:'Cal Poly SLO',state:'CA',system:'CSU',type:'public',city:'San Luis Obispo',avgGPA:4.06,avgSAT:1395,acceptRate:32.5,tuitionIn:10377,tuitionOut:22257,rank:null,size:'large',setting:'suburban'},
  {id:'sdsu',name:'San Diego State',state:'CA',system:'CSU',type:'public',city:'San Diego',avgGPA:3.85,avgSAT:1270,acceptRate:37.8,tuitionIn:7720,tuitionOut:19600,rank:null,size:'large',setting:'urban'},
  
  // Private CA
  {id:'stanford',name:'Stanford',state:'CA',system:'Private',type:'private',city:'Stanford',avgGPA:4.18,avgSAT:1520,acceptRate:4.0,tuitionIn:61650,tuitionOut:61650,rank:3,size:'medium',setting:'suburban'},
  {id:'usc',name:'USC',state:'CA',system:'Private',type:'private',city:'Los Angeles',avgGPA:3.9,avgSAT:1460,acceptRate:10.5,tuitionIn:68337,tuitionOut:68337,rank:28,size:'large',setting:'urban'},
  
  // NY Schools
  {id:'columbia',name:'Columbia',state:'NY',system:'Ivy',type:'private',city:'New York',avgGPA:4.15,avgSAT:1530,acceptRate:5.0,tuitionIn:66600,tuitionOut:66600,rank:12,size:'medium',setting:'urban'},
  {id:'nyu',name:'NYU',state:'NY',system:'Private',type:'private',city:'New York',avgGPA:3.8,avgSAT:1500,acceptRate:12.5,tuitionIn:58960,tuitionOut:58960,rank:35,size:'large',setting:'urban'},
  
  // Add more schools...
];

// Validators
const Validators = {
  gpa: (val) => {
    const n = parseFloat(val);
    if (isNaN(n) || n < 0 || n > 5) {
      return { valid: false, error: 'GPA must be between 0.0 and 5.0' };
    }
    return { valid: true, value: n };
  },
  
  sat: (val) => {
    if (!val) return { valid: true, value: null };
    const n = parseInt(val);
    if (isNaN(n) || n < 400 || n > 1600) {
      return { valid: false, error: 'SAT score must be between 400 and 1600' };
    }
    return { valid: true, value: n };
  },
  
  income: (val) => {
    if (!val) return { valid: true, value: null };
    const n = parseInt(val);
    if (isNaN(n) || n < 0) {
      return { valid: false, error: 'Income must be a positive number' };
    }
    return { valid: true, value: n };
  },
  
  ap: (val) => {
    const n = parseInt(val) || 0;
    if (n < 0 || n > 30) {
      return { valid: false, error: 'AP courses must be between 0 and 30' };
    }
    return { valid: true, value: n };
  },
  
  required: (val, fieldName) => {
    if (!val || val.trim() === '') {
      return { valid: false, error: `${fieldName} is required` };
    }
    return { valid: true, value: val.trim() };
  }
};

// Toast Notification System
class Toast {
  static show(message, type = 'info', duration = 3000) {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
      <span class="toast-icon">${this.getIcon(type)}</span>
      <span>${message}</span>
    `;
    
    container.appendChild(toast);
    
    // Trigger reflow for animation
    toast.offsetHeight;
    
    setTimeout(() => toast.classList.add('show'), 10);
    
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 300);
    }, duration);
  }
  
  static getIcon(type) {
    const icons = {
      success: '‚úÖ',
      error: '‚ùå',
      warning: '‚ö†Ô∏è',
      info: '‚ÑπÔ∏è'
    };
    return icons[type] || icons.info;
  }
}

// Achievement System
class AchievementSystem {
  static ACHIEVEMENTS = {
    first_school: {
      id: 'first_school',
      icon: 'üéØ',
      title: 'First Pick',
      description: 'Added your first school to the list'
    },
    five_schools: {
      id: 'five_schools',
      icon: 'üî•',
      title: 'On Fire',
      description: 'Added 5 schools to your list'
    },
    balanced_list: {
      id: 'balanced_list',
      icon: '‚öñÔ∏è',
      title: 'Perfectly Balanced',
      description: 'Have reach, match, and safety schools'
    },
    early_bird: {
      id: 'early_bird',
      icon: 'üèÉ',
      title: 'Early Bird',
      description: 'Started planning 6+ months before deadline'
    },
    profile_complete: {
      id: 'profile_complete',
      icon: '‚ú®',
      title: 'Profile Complete',
      description: 'Filled out all profile information'
    }
  };
  
  static check(appState) {
    const user = appState.get('user');
    const mySchools = appState.get('mySchools') || [];
    const achievements = appState.get('achievements') || [];
    
    // Check first school
    if (mySchools.length >= 1 && !achievements.includes('first_school')) {
      this.unlock('first_school', appState);
    }
    
    // Check five schools
    if (mySchools.length >= 5 && !achievements.includes('five_schools')) {
      this.unlock('five_schools', appState);
    }
    
    // Check balanced list
    if (this.hasBalancedList(mySchools, appState) && !achievements.includes('balanced_list')) {
      this.unlock('balanced_list', appState);
    }
    
    // Check profile complete
    if (this.isProfileComplete(user) && !achievements.includes('profile_complete')) {
      this.unlock('profile_complete', appState);
    }
  }
  
  static unlock(achievementId, appState) {
    const achievement = this.ACHIEVEMENTS[achievementId];
    if (!achievement) return;
    
    const achievements = appState.get('achievements') || [];
    achievements.push(achievementId);
    appState.update('achievements', achievements);
    
    this.showNotification(achievement);
    this.celebrate();
  }
  
  static showNotification(achievement) {
    const container = document.getElementById('achievementsContainer');
    const elem = document.createElement('div');
    elem.className = 'achievement new';
    elem.innerHTML = `
      <div class="achievement-icon">${achievement.icon}</div>
      <div class="achievement-content">
        <h4>${achievement.title}</h4>
        <p>${achievement.description}</p>
      </div>
    `;
    
    container.appendChild(elem);
    
    setTimeout(() => {
      elem.classList.remove('new');
    }, 3000);
    
    Toast.show(`Achievement Unlocked: ${achievement.title}`, 'success');
  }
  
  static celebrate() {
    // Haptic feedback
    if ('vibrate' in navigator) {
      navigator.vibrate([100, 50, 100]);
    }
    
    // Confetti animation
    const container = document.createElement('div');
    container.className = 'confetti-container';
    
    for (let i = 0; i < 50; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.animationDelay = Math.random() * 3 + 's';
      confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
      container.appendChild(confetti);
    }
    
    document.body.appendChild(container);
    setTimeout(() => container.remove(), 5000);
  }
  
  static hasBalancedList(schools, appState) {
    // Check if user has at least one school in each category
    // Implementation would check school categories
    return false; // Placeholder
  }
  
  static isProfileComplete(user) {
    if (!user) return false;
    return !!(user.firstName && user.grade && user.homeState && user.gpa);
  }
}

// School Matching Algorithm
class SchoolMatcher {
  static calculateMatch(school, user) {
    if (!user) return 50;
    
    let score = 50;
    
    // GPA comparison (¬±40 points)
    if (user.gpa) {
      const gpaDiff = (user.gpa - school.avgGPA) * 20;
      score += Math.max(-40, Math.min(40, gpaDiff));
    }
    
    // SAT comparison (¬±20 points)
    if (user.sat && school.avgSAT) {
      const satDiff = (user.sat - school.avgSAT) / 10;
      score += Math.max(-20, Math.min(20, satDiff));
    }
    
    // AP/Honors bonus (up to 15 points)
    if (user.ap) {
      score += Math.min(15, user.ap * 1.5);
    }
    
    // Interest alignment bonus (up to 10 points)
    if (user.interests) {
      score += this.getInterestBonus(school, user.interests);
    }
    
    // In-state bonus (5 points)
    if (user.homeState === school.state) {
      score += 5;
    }
    
    return Math.max(0, Math.min(100, Math.round(score)));
  }
  
  static getInterestBonus(school, interest) {
    const bonuses = {
      stem: ['stanford', 'caltech', 'ucb', 'ucla'],
      business: ['usc', 'nyu', 'columbia'],
      arts: ['nyu', 'usc', 'ucla']
    };
    
    const schoolsForInterest = bonuses[interest] || [];
    return schoolsForInterest.includes(school.id) ? 10 : 0;
  }
  
  static categorizeSchool(school, user) {
    const matchScore = this.calculateMatch(school, user);
    const gpaDiff = user.gpa ? user.gpa - school.avgGPA : 0;
    
    if (matchScore < 40 || gpaDiff < -0.3) {
      return 'reach';
    } else if (matchScore > 70 || gpaDiff > 0.3) {
      return 'safety';
    } else {
      return 'match';
    }
  }
}

// Financial Aid Calculator
class FinancialAidCalculator {
  static PELL_GRANT_TABLE = [
    { maxIncome: 30000, amount: 7395 },
    { maxIncome: 45000, amount: 4500 },
    { maxIncome: 60000, amount: 1500 },
    { maxIncome: 75000, amount: 500 }
  ];
  
  static STATE_GRANTS = {
    CA: {
      calGrantA: { minGPA: 3.0, maxIncome: 125000, ucAmount: 12570, csuAmount: 5742, privateAmount: 9850 },
      middleClass: { maxIncome: 217000, amount: 2500 }
    },
    NY: {
      tap: [
        { maxIncome: 80000, amount: 5500 },
        { maxIncome: 100000, amount: 3000 }
      ]
    }
  };
  
  static calculate(school, user) {
    if (!user || !user.income) {
      return { items: [], total: 0, netPrice: school.tuitionIn };
    }
    
    const items = [];
    let totalAid = 0;
    
    // Calculate Pell Grant
    const pellAmount = this.calculatePellGrant(user.income);
    if (pellAmount > 0) {
      items.push({ name: 'Federal Pell Grant', amount: pellAmount });
      totalAid += pellAmount;
    }
    
    // Calculate state grants
    if (user.homeState === school.state) {
      const stateAid = this.calculateStateGrant(school, user);
      if (stateAid.amount > 0) {
        items.push({ name: stateAid.name, amount: stateAid.amount });
        totalAid += stateAid.amount;
      }
    }
    
    // Calculate institutional aid (simplified)
    if (school.type === 'private' && user.income < 100000) {
      const instAid = Math.round((100000 - user.income) / 100 * 50);
      items.push({ name: 'Institutional Aid (est.)', amount: instAid });
      totalAid += instAid;
    }
    
    const tuition = user.homeState === school.state ? school.tuitionIn : school.tuitionOut;
    const netPrice = Math.max(0, tuition - totalAid);
    
    return { items, total: totalAid, netPrice, tuition };
  }
  
  static calculatePellGrant(income) {
    for (const bracket of this.PELL_GRANT_TABLE) {
      if (income <= bracket.maxIncome) {
        return bracket.amount;
      }
    }
    return 0;
  }
  
  static calculateStateGrant(school, user) {
    const grants = this.STATE_GRANTS[user.homeState];
    if (!grants) return { name: '', amount: 0 };
    
    if (user.homeState === 'CA') {
      const { calGrantA, middleClass } = grants;
      
      if (user.gpa >= calGrantA.minGPA && user.income <= calGrantA.maxIncome) {
        let amount = 0;
        if (school.system === 'UC') amount = calGrantA.ucAmount;
        else if (school.system === 'CSU') amount = calGrantA.csuAmount;
        else if (school.type === 'private') amount = calGrantA.privateAmount;
        
        if (amount > 0) {
          return { name: 'Cal Grant A', amount };
        }
      }
      
      if (user.income <= middleClass.maxIncome) {
        return { name: 'Middle Class Scholarship', amount: middleClass.amount };
      }
    }
    
    return { name: '', amount: 0 };
  }
}

// Document Tracker
class DocumentTracker {
  static generateDocuments(schools, user) {
    const docs = new Map();
    
    // Common documents
    docs.set('fafsa', {
      id: 'fafsa',
      name: 'FAFSA',
      due: new Date(2025, 9, 1), // Oct 1, 2025
      status: 'pending',
      universal: true
    });
    
    docs.set('profile', {
      id: 'profile',
      name: 'Personal Statement',
      due: new Date(2025, 10, 15), // Nov 15, 2025
      status: 'pending',
      universal: true
    });
    
    // School-specific documents
    schools.forEach(schoolId => {
      const school = SCHOOLS_DB.find(s => s.id === schoolId);
      if (!school) return;
      
      // Application
      docs.set(`${schoolId}_app`, {
        id: `${schoolId}_app`,
        name: `${school.name} Application`,
        due: new Date(2025, 10, 30), // Nov 30 for UC/CSU, adjust as needed
        status: 'pending',
        schoolId
      });
      
      // Essays
      docs.set(`${schoolId}_essays`, {
        id: `${schoolId}_essays`,
        name: `${school.name} Essays`,
        due: new Date(2025, 10, 15),
        status: 'pending',
        schoolId
      });
      
      // Transcripts
      docs.set(`${schoolId}_transcript`, {
        id: `${schoolId}_transcript`,
        name: `${school.name} Transcript`,
        due: new Date(2025, 10, 1),
        status: 'pending',
        schoolId
      });
    });
    
    return Array.from(docs.values());
  }
  
  static getProgress(documents) {
    const total = documents.length;
    const completed = documents.filter(d => d.status === 'completed').length;
    return total > 0 ? Math.round((completed / total) * 100) : 0;
  }
  
  static getUrgency(dueDate) {
    const now = new Date();
    const days = Math.floor((dueDate - now) / (1000 * 60 * 60 * 24));
    
    if (days < 0) return 'overdue';
    if (days <= 7) return 'urgent-high';
    if (days <= 30) return 'urgent-medium';
    return 'urgent-low';
  }
}

// UI Controller
class UIController {
  constructor(appState) {
    this.appState = appState;
    this.initElements();
    this.bindEvents();
    this.setupSubscriptions();
    this.applyTheme();
  }
  
  initElements() {
    // Sections
    this.planningSection = document.getElementById('planningSection');
    this.dashboardSection = document.getElementById('dashboardSection');
    
    // Forms
    this.planningForm = document.getElementById('planningForm');
    
    // Navigation
    this.tabs = document.querySelectorAll('.tab');
    this.backBtn = document.getElementById('backBtn');
    this.themeBtn = document.getElementById('themeBtn');
    this.resetBtn = document.getElementById('resetBtn');
    this.profileBtn = document.getElementById('profileBtn');
    
    // AI
    this.aiBubble = document.getElementById('aiBubble');
    this.aiMessage = document.getElementById('aiMessage');
    
    // Containers
    this.reachSchools = document.getElementById('reachSchools');
    this.matchSchools = document.getElementById('matchSchools');
    this.safetySchools = document.getElementById('safetySchools');
    this.mySchoolsList = document.getElementById('mySchoolsList');
    this.aidEstimates = document.getElementById('aidEstimates');
    this.documentsList = document.getElementById('documentsList');
    this.timelineList = document.getElementById('timelineList');
    this.insightsContent = document.getElementById('insightsContent');
  }
  
  bindEvents() {
    // Form submission
    this.planningForm.addEventListener('submit', (e) => {
      e.preventDefault();
      this.handlePlanningSubmit();
    });
    
    // Form validation on change
    this.planningForm.querySelectorAll('input, select').forEach(input => {
      input.addEventListener('blur', () => this.validateField(input));
      input.addEventListener('input', () => this.updateMatchPreview());
    });
    
    // Navigation
    this.tabs.forEach(tab => {
      tab.addEventListener('click', () => this.switchTab(tab.dataset.tab));
    });
    
    this.backBtn.addEventListener('click', () => this.showPlanning());
    this.themeBtn.addEventListener('click', () => this.toggleTheme());
    this.resetBtn.addEventListener('click', () => this.confirmReset());
    this.profileBtn.addEventListener('click', () => this.showProfile());
    
    // Filters
    document.getElementById('filterState').addEventListener('change', () => this.filterSchools());
    document.getElementById('filterType').addEventListener('change', () => this.filterSchools());
    document.getElementById('searchSchool').addEventListener('input', debounce(() => this.filterSchools(), 300));
    
    // AI Assistant
    this.aiBubble.addEventListener('click', () => this.handleAIClick());
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') this.closeModals();
    });
  }
  
  setupSubscriptions() {
    this.appState.subscribe('user', () => this.renderProfile());
    this.appState.subscribe('mySchools', () => {
      this.renderMySchools();
      this.renderFinancialAid();
      this.renderDocuments();
      this.renderTimeline();
      AchievementSystem.check(this.appState);
    });
    this.appState.subscribe('ui.currentSection', (section) => {
      if (section === 'dashboard') this.showDashboard();
      else this.showPlanning();
    });
  }
  
  validateField(input) {
    const field = input.closest('.field');
    const name = input.name;
    const value = input.value;
    
    // Remove previous error
    field.classList.remove('error');
    const existingError = field.querySelector('.error-msg');
    if (existingError) existingError.remove();
    
    // Validate based on field type
    let result = { valid: true };
    
    if (input.hasAttribute('required')) {
      result = Validators.required(value, input.labels[0]?.textContent || name);
    }
    
    if (result.valid && name in Validators) {
      result = Validators[name](value);
    }
    
    if (!result.valid) {
      field.classList.add('error');
      const error = document.createElement('div');
      error.className = 'error-msg';
      error.textContent = result.error;
      field.appendChild(error);
      return false;
    }
    
    return true;
  }
  
  handlePlanningSubmit() {
    const form = this.planningForm;
    const inputs = form.querySelectorAll('input, select');
    let isValid = true;
    
    inputs.forEach(input => {
      if (!this.validateField(input)) {
        isValid = false;
      }
    });
    
    if (!isValid) {
      Toast.show('Please correct the errors in the form', 'error');
      return;
    }
    
    // Create user profile
    const formData = new FormData(form);
    const user = {
      firstName: formData.get('firstName'),
      grade: formData.get('grade'),
      homeState: formData.get('homeState'),
      income: parseInt(formData.get('income')) || null,
      gpa: parseFloat(formData.get('gpa')) || null,
      sat: parseInt(formData.get('sat')) || null,
      ap: parseInt(formData.get('ap')) || 0,
      interests: formData.get('interests') || null
    };
    
    this.appState.update('user', user);
    this.appState.update('ui.currentSection', 'dashboard');
    
    Toast.show(`Welcome, ${user.firstName}! Let's find your perfect schools.`, 'success');
    this.showAIMessage("Great profile! I'll help you build a balanced school list. Start by exploring the schools below!");
    
    // Check initial achievements
    if (this.isProfileComplete(user)) {
      AchievementSystem.unlock('profile_complete', this.appState);
    }
  }
  
  isProfileComplete(user) {
    return !!(user.firstName && user.grade && user.homeState && user.gpa);
  }
  
  updateMatchPreview() {
    const form = this.planningForm;
    const formData = new FormData(form);
    
    const tempUser = {
      gpa: parseFloat(formData.get('gpa')) || null,
      sat: parseInt(formData.get('sat')) || null,
      ap: parseInt(formData.get('ap')) || 0,
      interests: formData.get('interests') || null,
      homeState: formData.get('homeState') || null
    };
    
    let matchCount = 0;
    SCHOOLS_DB.forEach(school => {
      const score = SchoolMatcher.calculateMatch(school, tempUser);
      if (score >= 50) matchCount++;
    });
    
    document.getElementById('matchCounter').textContent = `${matchCount} potential matches`;
  }
  
  showPlanning() {
    this.planningSection.classList.remove('hidden');
    this.dashboardSection.classList.add('hidden');
    this.backBtn.classList.add('hidden');
  }
  
  showDashboard() {
    this.planningSection.classList.add('hidden');
    this.dashboardSection.classList.remove('hidden');
    this.backBtn.classList.remove('hidden');
    this.renderDashboard();
  }
  
  renderDashboard() {
    this.renderStats();
    this.renderSchools();
    this.renderMySchools();
    this.renderFinancialAid();
    this.renderDocuments();
    this.renderTimeline();
    this.renderInsights();
  }
  
  renderStats() {
    const user = this.appState.get('user');
    const mySchools = this.appState.get('mySchools') || [];
    
    // Profile strength
    let profileStrength = 0;
    if (user) {
      if (user.firstName) profileStrength += 20;
      if (user.grade) profileStrength += 20;
      if (user.homeState) profileStrength += 20;
      if (user.gpa) profileStrength += 20;
      if (user.sat || user.ap) profileStrength += 20;
    }
    
    const progressCircle = document.getElementById('profileProgress');
    const circumference = 2 * Math.PI * 25;
    const offset = circumference - (profileStrength / 100) * circumference;
    progressCircle.style.strokeDashoffset = offset;
    document.getElementById('profilePercent').textContent = `${profileStrength}%`;
    
    // School count
    document.getElementById('schoolCount').textContent = mySchools.length;
    const schoolProgress = Math.min(100, (mySchools.length / 10) * 100);
    document.getElementById('schoolProgress').style.width = `${schoolProgress}%`;
    
    // Days until deadline
    const deadline = new Date(2025, 10, 30); // Nov 30, 2025
    const today = new Date();
    const days = Math.floor((deadline - today) / (1000 * 60 * 60 * 24));
    document.getElementById('daysLeft').textContent = days > 0 ? days : 'Past';
    document.getElementById('nextDeadline').textContent = 'UC/CSU Applications';
  }
  
  renderSchools() {
    const user = this.appState.get('user');
    const mySchoolIds = this.appState.get('mySchools') || [];
    
    const reach = [];
    const match = [];
    const safety = [];
    
    SCHOOLS_DB.forEach(school => {
      const category = SchoolMatcher.categorizeSchool(school, user);
      const card = this.createSchoolCard(school, mySchoolIds.includes(school.id));
      
      if (category === 'reach') reach.push(card);
      else if (category === 'match') match.push(card);
      else safety.push(card);
    });
    
    this.reachSchools.innerHTML = reach.length ? reach.join('') : this.createEmptyState('reach');
    this.matchSchools.innerHTML = match.length ? match.join('') : this.createEmptyState('match');
    this.safetySchools.innerHTML = safety.length ? safety.join('') : this.createEmptyState('safety');
  }
  
  createSchoolCard(school, isAdded) {
    const user = this.appState.get('user');
    const matchScore = SchoolMatcher.calculateMatch(school, user);
    const tuition = user?.homeState === school.state ? school.tuitionIn : school.tuitionOut;
    
    return `
      <div class="school-card" data-school-id="${school.id}">
        <span class="pill">${matchScore}% match</span>
        <h4>${school.name}</h4>
        <div class="school-meta">${school.city}, ${school.state} ‚Ä¢ ${school.system}</div>
        <div class="school-stats">
          <div class="stat-item">
            <span class="stat-label">GPA</span>
            <span class="stat-value">${school.avgGPA}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">SAT</span>
            <span class="stat-value">${school.avgSAT}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Accept</span>
            <span class="stat-value">${school.acceptRate}%</span>
          </div>
        </div>
        <div class="school-meta">Tuition: ${tuition.toLocaleString()}/year</div>
        <div class="school-actions">
          <button class="btn ${isAdded ? 'success' : 'primary'}" 
                  onclick="app.toggleSchool('${school.id}')"
                  ${isAdded ? 'disabled' : ''}>
            ${isAdded ? '‚úì Added' : 'Add to List'}
          </button>
          <button class="btn ghost" onclick="app.showSchoolDetails('${school.id}')">Details</button>
        </div>
      </div>
    `;
  }
  
  createEmptyState(type) {
    const messages = {
      reach: 'No reach schools found. Try adjusting your profile!',
      match: 'No match schools found. Update your stats to see matches.',
      safety: 'No safety schools found. Great profile!'
    };
    
    return `
      <div class="empty-state">
        <div class="empty-icon">üéØ</div>
        <p>${messages[type]}</p>
      </div>
    `;
  }
  
  renderMySchools() {
    const mySchoolIds = this.appState.get('mySchools') || [];
    const user = this.appState.get('user');
    
    if (mySchoolIds.length === 0) {
      this.mySchoolsList.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">üìö</div>
          <h3>No schools added yet</h3>
          <p>Add schools from the lists above to build your application list.</p>
        </div>
      `;
      return;
    }
    
    const schoolCards = mySchoolIds.map(id => {
      const school = SCHOOLS_DB.find(s => s.id === id);
      if (!school) return '';
      
      const aid = FinancialAidCalculator.calculate(school, user);
      
      return `
        <div class="card mb-4">
          <div class="flex justify-between items-center">
            <div>
              <h4>${school.name}</h4>
              <div class="text-muted text-sm">${school.city}, ${school.state}</div>
            </div>
            <div class="flex gap-2">
              <div class="badge">Net: ${aid.netPrice.toLocaleString()}</div>
              <button class="btn danger" onclick="app.removeSchool('${school.id}')">Remove</button>
            </div>
          </div>
        </div>
      `;
    }).join('');
    
    this.mySchoolsList.innerHTML = schoolCards;
  }
  
  renderFinancialAid() {
    const mySchoolIds = this.appState.get('mySchools') || [];
    const user = this.appState.get('user');
    
    if (mySchoolIds.length === 0) {
      this.aidEstimates.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">üí∞</div>
          <p>Add schools to see financial aid estimates.</p>
        </div>
      `;
      return;
    }
    
    const aidCards = mySchoolIds.map(id => {
      const school = SCHOOLS_DB.find(s => s.id === id);
      if (!school) return '';
      
      const aid = FinancialAidCalculator.calculate(school, user);
      
      const aidItems = aid.items.map(item => `
        <div class="flex justify-between">
          <span>${item.name}</span>
          <span class="font-bold">${item.amount.toLocaleString()}</span>
        </div>
      `).join('');
      
      return `
        <div class="card mb-4">
          <h4>${school.name}</h4>
          <div class="grid gap-2 mt-3">
            ${aidItems}
            <hr>
            <div class="flex justify-between">
              <span>Tuition</span>
              <span>${aid.tuition.toLocaleString()}</span>
            </div>
            <div class="flex justify-between font-bold">
              <span>Net Price</span>
              <span class="text-lg">${aid.netPrice.toLocaleString()}</span>
            </div>
          </div>
        </div>
      `;
    }).join('');
    
    this.aidEstimates.innerHTML = aidCards;
  }
  
  renderDocuments() {
    const mySchoolIds = this.appState.get('mySchools') || [];
    const user = this.appState.get('user');
    const documents = this.appState.get('documents') || DocumentTracker.generateDocuments(mySchoolIds, user);
    
    if (documents.length === 0) {
      this.documentsList.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">üìù</div>
          <p>Add schools to generate your document checklist.</p>
        </div>
      `;
      document.getElementById('docProgress').textContent = '0% Complete';
      return;
    }
    
    const progress = DocumentTracker.getProgress(documents);
    document.getElementById('docProgress').textContent = `${progress}% Complete`;
    
    const docCards = documents.map(doc => {
      const urgency = DocumentTracker.getUrgency(doc.due);
      const daysLeft = Math.floor((doc.due - new Date()) / (1000 * 60 * 60 * 24));
      
      return `
        <div class="card mb-3 ${urgency}">
          <div class="flex justify-between items-center">
            <div class="flex items-center gap-3">
              <input type="checkbox" 
                     id="doc-${doc.id}"
                     ${doc.status === 'completed' ? 'checked' : ''}
                     onchange="app.toggleDocument('${doc.id}')">
              <label for="doc-${doc.id}">
                <div class="font-bold">${doc.name}</div>
                <div class="text-sm text-muted">Due ${doc.due.toLocaleDateString()} (${daysLeft} days)</div>
              </label>
            </div>
            ${doc.id.includes('essays') ? `
              <button class="btn ghost" onclick="app.showEssayHelp('${doc.schoolId}')">
                Get Help
              </button>
            ` : ''}
          </div>
        </div>
      `;
    }).join('');
    
    this.documentsList.innerHTML = docCards;
  }
  
  renderTimeline() {
    const mySchoolIds = this.appState.get('mySchools') || [];
    const user = this.appState.get('user');
    const documents = this.appState.get('documents') || DocumentTracker.generateDocuments(mySchoolIds, user);
    
    if (documents.length === 0) {
      this.timelineList.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">üìÖ</div>
          <p>Your timeline will appear here once you add schools.</p>
        </div>
      `;
      return;
    }
    
    // Sort by due date
    const sorted = [...documents].sort((a, b) => a.due - b.due);
    
    const timelineItems = sorted.map(doc => {
      const urgency = DocumentTracker.getUrgency(doc.due);
      const daysLeft = Math.floor((doc.due - new Date()) / (1000 * 60 * 60 * 24));
      
      return `
        <div class="timeline-item ${urgency}">
          <div class="flex justify-between items-center">
            <div>
              <div class="font-bold">${doc.name}</div>
              <div class="text-sm text-muted">${doc.due.toLocaleDateString()}</div>
            </div>
            <div class="badge">${daysLeft} days</div>
          </div>
        </div>
      `;
    }).join('');
    
    this.timelineList.innerHTML = timelineItems;
  }
  
  renderInsights() {
    const user = this.appState.get('user');
    const mySchools = this.appState.get('mySchools') || [];
    
    const insights = [];
    
    // Balance check
    const categories = { reach: 0, match: 0, safety: 0 };
    mySchools.forEach(id => {
      const school = SCHOOLS_DB.find(s => s.id === id);
      if (school) {
        const cat = SchoolMatcher.categorizeSchool(school, user);
        categories[cat]++;
      }
    });
    
    if (mySchools.length > 0) {
      if (categories.reach === 0) {
        insights.push({
          type: 'warning',
          title: 'Add Reach Schools',
          text: 'Consider adding some ambitious choices to your list.'
        });
      }
      if (categories.safety === 0) {
        insights.push({
          type: 'warning',
          title: 'Add Safety Schools',
          text: 'Include some schools with higher acceptance chances for balance.'
        });
      }
      if (categories.match > 5) {
        insights.push({
          type: 'info',
          title: 'Well Matched',
          text: 'You have great match schools! Consider narrowing down to your favorites.'
        });
      }
    }
    
    // Financial insights
    if (user?.income && mySchools.length > 0) {
      const avgNetPrice = mySchools.reduce((sum, id) => {
        const school = SCHOOLS_DB.find(s => s.id === id);
        if (school) {
          const aid = FinancialAidCalculator.calculate(school, user);
          return sum + aid.netPrice;
        }
        return sum;
      }, 0) / mySchools.length;
      
      insights.push({
        type: 'info',
        title: 'Average Net Price',
        text: `Your average estimated cost is ${Math.round(avgNetPrice).toLocaleString()} per year.`
      });
    }
    
    if (insights.length === 0) {
      insights.push({
        type: 'info',
        title: 'Getting Started',
        text: 'Add schools to see personalized insights about your application strategy.'
      });
    }
    
    this.insightsContent.innerHTML = insights.map(insight => `
      <div class="card mb-3">
        <div class="badge ${insight.type}">${insight.type.toUpperCase()}</div>
        <h4 class="mt-2">${insight.title}</h4>
        <p class="text-muted">${insight.text}</p>
      </div>
    `).join('');
  }
  
  toggleSchool(schoolId) {
    const mySchools = this.appState.get('mySchools') || [];
    
    if (mySchools.includes(schoolId)) {
      // Remove school
      const updated = mySchools.filter(id => id !== schoolId);
      this.appState.update('mySchools', updated);
      Toast.show('School removed from list', 'info');
    } else {
      // Add school
      const updated = [...mySchools, schoolId];
      this.appState.update('mySchools', updated);
      Toast.show('School added to list!', 'success');
      
      // Check achievements
      AchievementSystem.check(this.appState);
    }
    
    this.renderSchools();
  }
  
  removeSchool(schoolId) {
    const mySchools = this.appState.get('mySchools') || [];
    const updated = mySchools.filter(id => id !== schoolId);
    this.appState.update('mySchools', updated);
    this.renderSchools();
    Toast.show('School removed', 'info');
  }
  
  showSchoolDetails(schoolId) {
    const school = SCHOOLS_DB.find(s => s.id === schoolId);
    if (!school) return;
    
    // This would open a modal with detailed school information
    Toast.show(`Showing details for ${school.name}`, 'info');
  }
  
  toggleDocument(docId) {
    const documents = this.appState.get('documents') || [];
    const doc = documents.find(d => d.id === docId);
    if (doc) {
      doc.status = doc.status === 'completed' ? 'pending' : 'completed';
      this.appState.update('documents', [...documents]);
      
      if (doc.status === 'completed') {
        Toast.show('Document marked complete!', 'success');
        AchievementSystem.celebrate();
      }
    }
  }
  
  showEssayHelp(schoolId) {
    this.showAIMessage(`I can help you brainstorm essay topics for this school! Consider writing about your unique experiences and what makes you a great fit.`);
  }
  
  switchTab(tabName) {
    // Update active tab
    this.tabs.forEach(tab => {
      tab.classList.toggle('active', tab.dataset.tab === tabName);
      tab.setAttribute('aria-selected', tab.dataset.tab === tabName);
    });
    
    // Show corresponding content
    const tabContents = ['schoolsTab', 'financialTab', 'documentsTab', 'timelineTab', 'insightsTab'];
    tabContents.forEach(id => {
      const element = document.getElementById(id);
      element.classList.toggle('hidden', !id.startsWith(tabName));
    });
    
    this.appState.update('ui.currentTab', tabName);
  }
  
  filterSchools() {
    // Get filter values
    const state = document.getElementById('filterState').value;
    const type = document.getElementById('filterType').value;
    const search = document.getElementById('searchSchool').value.toLowerCase();
    
    this.appState.update('filters', { state, type, search });
    
    // Re-render with filters
    this.renderSchools();
  }
  
  toggleTheme() {
    const current = this.appState.get('ui.theme') || 'light';
    const next = current === 'light' ? 'dark' : 'light';
    
    document.documentElement.setAttribute('data-theme', next);
    this.appState.update('ui.theme', next);
    
    this.themeBtn.textContent = next === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    Toast.show(`Switched to ${next} mode`, 'info');
  }
  
  applyTheme() {
    const theme = this.appState.get('ui.theme') || 'light';
    document.documentElement.setAttribute('data-theme', theme);
    this.themeBtn.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
  }
  
  confirmReset() {
    if (confirm('This will delete all your data. Are you sure?')) {
      this.appState.reset();
      Toast.show('All data has been reset', 'info');
    }
  }
  
  showProfile() {
    const user = this.appState.get('user');
    if (!user) {
      Toast.show('Complete the planning form first', 'warning');
      return;
    }
    
    const modal = document.getElementById('profileModal');
    const content = document.getElementById('profileContent');
    
    content.innerHTML = `
      <div class="grid gap-3">
        <div><strong>Name:</strong> ${user.firstName}</div>
        <div><strong>Grade:</strong> ${user.grade}</div>
        <div><strong>State:</strong> ${user.homeState}</div>
        <div><strong>GPA:</strong> ${user.gpa || 'Not provided'}</div>
        <div><strong>SAT:</strong> ${user.sat || 'Not provided'}</div>
        <div><strong>AP Courses:</strong> ${user.ap || 0}</div>
      </div>
    `;
    
    modal.classList.add('active');
  }
  
  closeModals() {
    document.querySelectorAll('.modal-overlay').forEach(modal => {
      modal.classList.remove('active');
    });
  }
  
  handleAIClick() {
    const suggestions = [
      "Let me help you find schools that match your profile!",
      "Have you considered adding more safety schools?",
      "Your essay deadlines are coming up - need help brainstorming?",
      "Based on your interests, you might like these programs...",
      "Don't forget to complete your FAFSA by October 1st!"
    ];
    
    const random = suggestions[Math.floor(Math.random() * suggestions.length)];
    this.showAIMessage(random);
  }
  
  showAIMessage(message) {
    this.aiMessage.textContent = message;
    this.aiBubble.classList.remove('hidden');
    
    setTimeout(() => {
      this.aiBubble.classList.add('hidden');
    }, 8000);
  }
}

// Helper Functions
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

function closeModal(modalId) {
  document.getElementById(modalId).classList.remove('active');
}

// Initialize Application
const appState = new AppState();
const ui = new UIController(appState);

// Global app object for inline handlers
window.app = {
  toggleSchool: (id) => ui.toggleSchool(id),
  removeSchool: (id) => ui.removeSchool(id),
  showSchoolDetails: (id) => ui.showSchoolDetails(id),
  toggleDocument: (id) => ui.toggleDocument(id),
  showEssayHelp: (id) => ui.showEssayHelp(id)
};

// Check if returning user
document.addEventListener('DOMContentLoaded', () => {
  const user = appState.get('user');
  if (user) {
    appState.update('ui.currentSection', 'dashboard');
    Toast.show(`Welcome back, ${user.firstName}!`, 'success');
  }
  
  // Show AI helper after delay
  setTimeout(() => {
    if (!user) {
      ui.showAIMessage("Hi! I'm here to help you navigate college applications. Let's start by filling out your profile!");
    }
  }, 3000);
});

// Native Bridge Support (if needed)
window.PathwiseBridge = {
  getState: () => JSON.stringify(appState.state),
  setState: (state) => {
    appState.state = { ...appState.state, ...JSON.parse(state) };
    appState.persist();
  },
  reset: () => appState.reset()
};

// Performance monitoring
if ('PerformanceObserver' in window) {
  const perfObserver = new PerformanceObserver((list) => {
    for (const entry of list.getEntries()) {
      if (entry.duration > 100) {
        console.warn('Slow interaction:', entry.name, entry.duration);
      }
    }
  });
  perfObserver.observe({ entryTypes: ['measure'] });
}

console.log('üéì Pathwise loaded successfully!');
</script>

</body>
</html>